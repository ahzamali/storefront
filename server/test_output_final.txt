[INFO] Scanning for projects...
[INFO] 
[INFO] ------------------< com.storefront:storefront-server >------------------
[INFO] Building storefront-server 0.0.1-SNAPSHOT
[INFO]   from pom.xml
[INFO] --------------------------------[ jar ]---------------------------------
[INFO] 
[INFO] --- resources:3.3.1:resources (default-resources) @ storefront-server ---
[INFO] Copying 1 resource from src\main\resources to target\classes
[INFO] Copying 7 resources from src\main\resources to target\classes
[INFO] 
[INFO] --- compiler:3.11.0:compile (default-compile) @ storefront-server ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- resources:3.3.1:testResources (default-testResources) @ storefront-server ---
[INFO] Copying 1 resource from src\test\resources to target\test-classes
[INFO] 
[INFO] --- compiler:3.11.0:testCompile (default-testCompile) @ storefront-server ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- surefire:3.1.2:test (default-test) @ storefront-server ---
[INFO] Using auto detected provider org.apache.maven.surefire.junitplatform.JUnitPlatformProvider
[INFO] 
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running com.storefront.AuthIntegrationTest
16:12:48.364 [main] INFO org.springframework.test.context.support.AnnotationConfigContextLoaderUtils -- Could not detect default configuration classes for test class [com.storefront.AuthIntegrationTest]: AuthIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
16:12:48.494 [main] INFO org.springframework.boot.test.context.SpringBootTestContextBootstrapper -- Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.AuthIntegrationTest

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.1)

2026-01-15T16:12:48.893+05:30  INFO 31296 --- [storefront-server] [           main] com.storefront.AuthIntegrationTest       : Starting AuthIntegrationTest using Java 25.0.1 with PID 31296 (started by Ahzam Ali in D:\e-workspace\StoreFront-v2\server)
2026-01-15T16:12:48.895+05:30  INFO 31296 --- [storefront-server] [           main] com.storefront.AuthIntegrationTest       : No active profile set, falling back to 1 default profile: "default"
2026-01-15T16:12:49.587+05:30  INFO 31296 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-15T16:12:49.672+05:30  INFO 31296 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 69 ms. Found 11 JPA repository interfaces.
2026-01-15T16:12:50.208+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-15T16:12:50.437+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:testdb_auth user=SA
2026-01-15T16:12:50.438+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-15T16:12:50.532+05:30  INFO 31296 --- [storefront-server] [           main] o.f.c.internal.license.VersionPrinter    : Flyway Community Edition 9.22.3 by Redgate
2026-01-15T16:12:50.532+05:30  INFO 31296 --- [storefront-server] [           main] o.f.c.internal.license.VersionPrinter    : See release notes here: https://rd.gt/416ObMi
2026-01-15T16:12:50.532+05:30  INFO 31296 --- [storefront-server] [           main] o.f.c.internal.license.VersionPrinter    : 
2026-01-15T16:12:50.603+05:30  INFO 31296 --- [storefront-server] [           main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:testdb_auth (H2 2.2)
2026-01-15T16:12:50.609+05:30  WARN 31296 --- [storefront-server] [           main] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-15T16:12:50.640+05:30  INFO 31296 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-15T16:12:50.645+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbValidate     : Successfully validated 3 migrations (execution time 00:00.018s)
2026-01-15T16:12:50.653+05:30  INFO 31296 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-15T16:12:50.684+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-15T16:12:50.694+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - init schema"
2026-01-15T16:12:50.738+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "4 - add reconciliation log"
2026-01-15T16:12:50.746+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - add product is active"
2026-01-15T16:12:50.762+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Successfully applied 3 migrations to schema "PUBLIC", now at version v5 (execution time 00:00.044s)
2026-01-15T16:12:50.867+05:30  INFO 31296 --- [storefront-server] [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-15T16:12:50.946+05:30  INFO 31296 --- [storefront-server] [           main] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.4.1.Final
2026-01-15T16:12:50.985+05:30  INFO 31296 --- [storefront-server] [           main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-15T16:12:51.241+05:30  INFO 31296 --- [storefront-server] [           main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-15T16:12:51.287+05:30  WARN 31296 --- [storefront-server] [           main] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-15T16:12:52.278+05:30  INFO 31296 --- [storefront-server] [           main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
Hibernate: alter table if exists bundle alter column price set data type numeric(38,2)
Hibernate: create table customer (id bigint generated by default as identity, created_at timestamp(6), name varchar(255) not null, phone varchar(255) not null, primary key (id))
Hibernate: alter table if exists customer_order alter column total_amount set data type numeric(38,2)
Hibernate: alter table if exists customer_order add column customer_id bigint
Hibernate: alter table if exists order_line alter column unit_price set data type numeric(38,2)
Hibernate: alter table if exists product alter column base_price set data type numeric(38,2)
Hibernate: alter table if exists reconciliation_log alter column total_revenue set data type numeric(38,2)
Hibernate: alter table if exists customer drop constraint if exists UK_o3uty20c6csmx5y4uk2tc5r4m
Hibernate: alter table if exists customer add constraint UK_o3uty20c6csmx5y4uk2tc5r4m unique (phone)
Hibernate: alter table if exists customer_order add constraint FKf9abd30bhiqvugayxlpq8ryq9 foreign key (customer_id) references customer
2026-01-15T16:12:52.340+05:30  INFO 31296 --- [storefront-server] [           main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-15T16:12:52.370+05:30  WARN 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : JWT signing key initialized (NEW KEY GENERATED - all previous tokens are now invalid)
2026-01-15T16:12:53.043+05:30  WARN 31296 --- [storefront-server] [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-15T16:12:53.144+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.a.w.s.WelcomePageHandlerMapping    : Adding welcome page: class path resource [static/index.html]
2026-01-15T16:12:53.342+05:30  INFO 31296 --- [storefront-server] [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@4ba32242, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@581f1f40, org.springframework.security.web.context.SecurityContextHolderFilter@eb5471c, org.springframework.security.web.header.HeaderWriterFilter@17796f47, org.springframework.web.filter.CorsFilter@52b2c255, org.springframework.security.web.authentication.logout.LogoutFilter@42718ebf, com.storefront.security.JwtAuthenticationFilter@1415f18d, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@6a90b5e8, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@1ff65426, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@4a9b4d4e, org.springframework.security.web.session.SessionManagementFilter@7c424dfe, org.springframework.security.web.access.ExceptionTranslationFilter@5d160056, org.springframework.security.web.access.intercept.AuthorizationFilter@10b063fd]
2026-01-15T16:12:53.615+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:testdb_auth'
2026-01-15T16:12:53.659+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.t.m.w.SpringBootMockServletContext : Initializing Spring TestDispatcherServlet ''
2026-01-15T16:12:53.659+05:30  INFO 31296 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Initializing Servlet ''
2026-01-15T16:12:53.660+05:30  INFO 31296 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Completed initialization in 1 ms
2026-01-15T16:12:53.675+05:30  INFO 31296 --- [storefront-server] [           main] com.storefront.AuthIntegrationTest       : Started AuthIntegrationTest in 5.034 seconds (process running for 6.074)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: non_existent
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
=== LOGIN DEBUG ===
Attempting login for username: superadmin
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
User found! Stored hash: $2a$10$hsRh0PpFa345fcAXLPOSu.KGa.ayBx9dQpTqmtYegwovoe3ltlOIS
Input password: password
Password matches: true
===================
2026-01-15T16:12:54.434+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:12:54.438+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: superadmin, Role: SUPER_ADMIN, Authority: ROLE_SUPER_ADMIN
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: admin_del
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
User found! Stored hash: $2a$10$S51p6Aq0T.H2GT5jg7IfA.OhkLgJG8S7O42TyMC9UuphDV1ry5SI6
Input password: pass
Password matches: true
===================
2026-01-15T16:12:54.653+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:12:54.656+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_del, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
2026-01-15T16:12:54.724+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:12:54.728+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_del, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:12:54.746+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:12:54.750+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_del, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type,au1_0.username from app_user au1_0 left join user_stores s1_0 on au1_0.id=s1_0.user_id left join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where au1_0.id=?
Hibernate: delete from app_user where id=?
=== LOGIN DEBUG ===
Attempting login for username: superadmin
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
User found! Stored hash: $2a$10$hsRh0PpFa345fcAXLPOSu.KGa.ayBx9dQpTqmtYegwovoe3ltlOIS
Input password: password
Password matches: true
===================
2026-01-15T16:12:54.839+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:12:54.841+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: superadmin, Role: SUPER_ADMIN, Authority: ROLE_SUPER_ADMIN
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: testuser_1768473774837
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
User found! Stored hash: $2a$10$TO8BOpY/kZFe.I1vhV/LDeEe.lCiMStRIrehTbVkRPjLNKZ12WfA6
Input password: password123
Password matches: true
===================
2026-01-15T16:12:55.005+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:12:55.008+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: superadmin, Role: SUPER_ADMIN, Authority: ROLE_SUPER_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 6.801 s -- in com.storefront.AuthIntegrationTest
[INFO] Running com.storefront.ConcurrencyIntegrationTest
2026-01-15T16:12:55.018+05:30  INFO 31296 --- [storefront-server] [           main] t.c.s.AnnotationConfigContextLoaderUtils : Could not detect default configuration classes for test class [com.storefront.ConcurrencyIntegrationTest]: ConcurrencyIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2026-01-15T16:12:55.021+05:30  INFO 31296 --- [storefront-server] [           main] .b.t.c.SpringBootTestContextBootstrapper : Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.ConcurrencyIntegrationTest

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.1)

2026-01-15T16:12:55.040+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.ConcurrencyIntegrationTest  : Starting ConcurrencyIntegrationTest using Java 25.0.1 with PID 31296 (started by Ahzam Ali in D:\e-workspace\StoreFront-v2\server)
2026-01-15T16:12:55.040+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.ConcurrencyIntegrationTest  : No active profile set, falling back to 1 default profile: "default"
2026-01-15T16:12:55.184+05:30  INFO 31296 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-15T16:12:55.202+05:30  INFO 31296 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 16 ms. Found 11 JPA repository interfaces.
2026-01-15T16:12:55.276+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-2 - Starting...
2026-01-15T16:12:55.278+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-2 - Added connection conn10: url=jdbc:h2:mem:testdb_conc user=SA
2026-01-15T16:12:55.279+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-2 - Start completed.
2026-01-15T16:12:55.285+05:30  INFO 31296 --- [storefront-server] [           main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:testdb_conc (H2 2.2)
2026-01-15T16:12:55.286+05:30  WARN 31296 --- [storefront-server] [           main] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-15T16:12:55.289+05:30  INFO 31296 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-15T16:12:55.290+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbValidate     : Successfully validated 3 migrations (execution time 00:00.002s)
2026-01-15T16:12:55.291+05:30  INFO 31296 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-15T16:12:55.296+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-15T16:12:55.299+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - init schema"
2026-01-15T16:12:55.309+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "4 - add reconciliation log"
2026-01-15T16:12:55.313+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - add product is active"
2026-01-15T16:12:55.318+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Successfully applied 3 migrations to schema "PUBLIC", now at version v5 (execution time 00:00.011s)
2026-01-15T16:12:55.332+05:30  INFO 31296 --- [storefront-server] [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-15T16:12:55.334+05:30  INFO 31296 --- [storefront-server] [           main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-15T16:12:55.337+05:30  INFO 31296 --- [storefront-server] [           main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-15T16:12:55.338+05:30  WARN 31296 --- [storefront-server] [           main] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-15T16:12:55.511+05:30  INFO 31296 --- [storefront-server] [           main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
Hibernate: alter table if exists bundle alter column price set data type numeric(38,2)
Hibernate: create table customer (id bigint generated by default as identity, created_at timestamp(6), name varchar(255) not null, phone varchar(255) not null, primary key (id))
Hibernate: alter table if exists customer_order alter column total_amount set data type numeric(38,2)
Hibernate: alter table if exists customer_order add column customer_id bigint
Hibernate: alter table if exists order_line alter column unit_price set data type numeric(38,2)
Hibernate: alter table if exists product alter column base_price set data type numeric(38,2)
Hibernate: alter table if exists reconciliation_log alter column total_revenue set data type numeric(38,2)
Hibernate: alter table if exists customer drop constraint if exists UK_o3uty20c6csmx5y4uk2tc5r4m
Hibernate: alter table if exists customer add constraint UK_o3uty20c6csmx5y4uk2tc5r4m unique (phone)
Hibernate: alter table if exists customer_order add constraint FKf9abd30bhiqvugayxlpq8ryq9 foreign key (customer_id) references customer
2026-01-15T16:12:55.541+05:30  INFO 31296 --- [storefront-server] [           main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-15T16:12:55.545+05:30  WARN 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : JWT signing key initialized (NEW KEY GENERATED - all previous tokens are now invalid)
2026-01-15T16:12:55.704+05:30  WARN 31296 --- [storefront-server] [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-15T16:12:55.712+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.a.w.s.WelcomePageHandlerMapping    : Adding welcome page: class path resource [static/index.html]
2026-01-15T16:12:55.739+05:30  INFO 31296 --- [storefront-server] [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@536a0bbe, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@367026f, org.springframework.security.web.context.SecurityContextHolderFilter@77a38cec, org.springframework.security.web.header.HeaderWriterFilter@2aaa5122, org.springframework.web.filter.CorsFilter@30ff3726, org.springframework.security.web.authentication.logout.LogoutFilter@6224872f, com.storefront.security.JwtAuthenticationFilter@467310c6, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@51b22f06, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@29e94753, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@2a0a654a, org.springframework.security.web.session.SessionManagementFilter@2b45ede, org.springframework.security.web.access.ExceptionTranslationFilter@3be3ba84, org.springframework.security.web.access.intercept.AuthorizationFilter@1531fbc8]
2026-01-15T16:12:55.790+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:testdb_conc'
2026-01-15T16:12:55.800+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.t.m.w.SpringBootMockServletContext : Initializing Spring TestDispatcherServlet ''
2026-01-15T16:12:55.800+05:30  INFO 31296 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Initializing Servlet ''
2026-01-15T16:12:55.800+05:30  INFO 31296 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Completed initialization in 0 ms
2026-01-15T16:12:55.805+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.ConcurrencyIntegrationTest  : Started ConcurrencyIntegrationTest in 0.781 seconds (process running for 8.204)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
=== LOGIN DEBUG ===
Attempting login for username: admin_conc
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
2026-01-15T16:12:55.995+05:30  INFO 31296 --- [storefront-server] [pool-3-thread-6] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
2026-01-15T16:12:55.994+05:30  INFO 31296 --- [storefront-server] [ool-3-thread-10] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
2026-01-15T16:12:55.995+05:30  INFO 31296 --- [storefront-server] [pool-3-thread-8] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
2026-01-15T16:12:55.995+05:30  INFO 31296 --- [storefront-server] [pool-3-thread-3] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
2026-01-15T16:12:55.995+05:30  INFO 31296 --- [storefront-server] [pool-3-thread-5] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
2026-01-15T16:12:55.995+05:30  INFO 31296 --- [storefront-server] [pool-3-thread-4] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
2026-01-15T16:12:55.995+05:30  INFO 31296 --- [storefront-server] [pool-3-thread-2] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
2026-01-15T16:12:55.996+05:30  INFO 31296 --- [storefront-server] [pool-3-thread-1] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
2026-01-15T16:12:55.996+05:30  INFO 31296 --- [storefront-server] [pool-3-thread-9] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
2026-01-15T16:12:55.995+05:30  INFO 31296 --- [storefront-server] [pool-3-thread-7] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:12:56.001+05:30  INFO 31296 --- [storefront-server] [pool-3-thread-2] c.s.security.CustomUserDetailsService    : User found: admin_conc, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:12:56.001+05:30  INFO 31296 --- [storefront-server] [pool-3-thread-4] c.s.security.CustomUserDetailsService    : User found: admin_conc, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:12:56.001+05:30  INFO 31296 --- [storefront-server] [pool-3-thread-3] c.s.security.CustomUserDetailsService    : User found: admin_conc, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:12:56.002+05:30  INFO 31296 --- [storefront-server] [pool-3-thread-6] c.s.security.CustomUserDetailsService    : User found: admin_conc, Role: ADMIN, Authority: ROLE_ADMIN
2026-01-15T16:12:56.002+05:30  INFO 31296 --- [storefront-server] [pool-3-thread-9] c.s.security.CustomUserDetailsService    : User found: admin_conc, Role: ADMIN, Authority: ROLE_ADMIN
2026-01-15T16:12:56.002+05:30  INFO 31296 --- [storefront-server] [ool-3-thread-10] c.s.security.CustomUserDetailsService    : User found: admin_conc, Role: ADMIN, Authority: ROLE_ADMIN
2026-01-15T16:12:56.002+05:30  INFO 31296 --- [storefront-server] [pool-3-thread-7] c.s.security.CustomUserDetailsService    : User found: admin_conc, Role: ADMIN, Authority: ROLE_ADMIN
2026-01-15T16:12:56.002+05:30  INFO 31296 --- [storefront-server] [pool-3-thread-5] c.s.security.CustomUserDetailsService    : User found: admin_conc, Role: ADMIN, Authority: ROLE_ADMIN
2026-01-15T16:12:56.003+05:30  INFO 31296 --- [storefront-server] [pool-3-thread-8] c.s.security.CustomUserDetailsService    : User found: admin_conc, Role: ADMIN, Authority: ROLE_ADMIN
2026-01-15T16:12:56.003+05:30  INFO 31296 --- [storefront-server] [pool-3-thread-1] c.s.security.CustomUserDetailsService    : User found: admin_conc, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from store s1_0 left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where s1_0.id=?
Hibernate: select s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from store s1_0 left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where s1_0.id=?
Hibernate: select s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from store s1_0 left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where s1_0.id=?
Hibernate: select s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from store s1_0 left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where s1_0.id=?
Hibernate: select s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from store s1_0 left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where s1_0.id=?
Hibernate: select s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from store s1_0 left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where s1_0.id=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from store s1_0 left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where s1_0.id=?
Hibernate: select s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from store s1_0 left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where s1_0.id=?
Hibernate: select s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from store s1_0 left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where s1_0.id=?
Hibernate: select s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from store s1_0 left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where s1_0.id=?
2026-01-15T16:12:56.086+05:30 ERROR 31296 --- [storefront-server] [pool-3-thread-8] com.storefront.config.SecurityConfig     : Access DENIED for POST /api/v1/stores/2/allocate - User: UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin_conc, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=127.0.0.1, SessionId=null], Granted Authorities=[ROLE_ADMIN]], Error: User does not have access to this store
2026-01-15T16:12:56.086+05:30 ERROR 31296 --- [storefront-server] [pool-3-thread-5] com.storefront.config.SecurityConfig     : Access DENIED for POST /api/v1/stores/2/allocate - User: UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin_conc, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=127.0.0.1, SessionId=null], Granted Authorities=[ROLE_ADMIN]], Error: User does not have access to this store
2026-01-15T16:12:56.086+05:30 ERROR 31296 --- [storefront-server] [pool-3-thread-1] com.storefront.config.SecurityConfig     : Access DENIED for POST /api/v1/stores/2/allocate - User: UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin_conc, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=127.0.0.1, SessionId=null], Granted Authorities=[ROLE_ADMIN]], Error: User does not have access to this store
2026-01-15T16:12:56.087+05:30 ERROR 31296 --- [storefront-server] [pool-3-thread-9] com.storefront.config.SecurityConfig     : Access DENIED for POST /api/v1/stores/2/allocate - User: UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin_conc, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=127.0.0.1, SessionId=null], Granted Authorities=[ROLE_ADMIN]], Error: User does not have access to this store
2026-01-15T16:12:56.086+05:30 ERROR 31296 --- [storefront-server] [pool-3-thread-4] com.storefront.config.SecurityConfig     : Access DENIED for POST /api/v1/stores/2/allocate - User: UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin_conc, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=127.0.0.1, SessionId=null], Granted Authorities=[ROLE_ADMIN]], Error: User does not have access to this store
2026-01-15T16:12:56.086+05:30 ERROR 31296 --- [storefront-server] [pool-3-thread-6] com.storefront.config.SecurityConfig     : Access DENIED for POST /api/v1/stores/2/allocate - User: UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin_conc, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=127.0.0.1, SessionId=null], Granted Authorities=[ROLE_ADMIN]], Error: User does not have access to this store
2026-01-15T16:12:56.087+05:30 ERROR 31296 --- [storefront-server] [pool-3-thread-7] com.storefront.config.SecurityConfig     : Access DENIED for POST /api/v1/stores/2/allocate - User: UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin_conc, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=127.0.0.1, SessionId=null], Granted Authorities=[ROLE_ADMIN]], Error: User does not have access to this store
2026-01-15T16:12:56.087+05:30 ERROR 31296 --- [storefront-server] [pool-3-thread-3] com.storefront.config.SecurityConfig     : Access DENIED for POST /api/v1/stores/2/allocate - User: UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin_conc, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=127.0.0.1, SessionId=null], Granted Authorities=[ROLE_ADMIN]], Error: User does not have access to this store
2026-01-15T16:12:56.087+05:30 ERROR 31296 --- [storefront-server] [ool-3-thread-10] com.storefront.config.SecurityConfig     : Access DENIED for POST /api/v1/stores/2/allocate - User: UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin_conc, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=127.0.0.1, SessionId=null], Granted Authorities=[ROLE_ADMIN]], Error: User does not have access to this store
2026-01-15T16:12:56.087+05:30 ERROR 31296 --- [storefront-server] [pool-3-thread-2] com.storefront.config.SecurityConfig     : Access DENIED for POST /api/v1/stores/2/allocate - User: UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin_conc, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=127.0.0.1, SessionId=null], Granted Authorities=[ROLE_ADMIN]], Error: User does not have access to this store
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Success count: 0
Master Qty: 100
Virtual Qty: 0
Total Stock: 100
[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 1.093 s <<< FAILURE! -- in com.storefront.ConcurrencyIntegrationTest
[ERROR] com.storefront.ConcurrencyIntegrationTest.testConcurrentAllocation -- Time elapsed: 0.227 s <<< ERROR!
java.lang.RuntimeException: Zero successful allocations - check configuration
	at com.storefront.ConcurrencyIntegrationTest.testConcurrentAllocation(ConcurrencyIntegrationTest.java:144)
	at java.base/java.lang.reflect.Method.invoke(Method.java:565)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)

[INFO] Running com.storefront.config.DataInitializerTest
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.310 s -- in com.storefront.config.DataInitializerTest
[INFO] Running com.storefront.CoreEntityIntegrationTest
2026-01-15T16:12:56.424+05:30  INFO 31296 --- [storefront-server] [           main] t.c.s.AnnotationConfigContextLoaderUtils : Could not detect default configuration classes for test class [com.storefront.CoreEntityIntegrationTest]: CoreEntityIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2026-01-15T16:12:56.426+05:30  INFO 31296 --- [storefront-server] [           main] .b.t.c.SpringBootTestContextBootstrapper : Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.CoreEntityIntegrationTest

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.1)

2026-01-15T16:12:56.444+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.CoreEntityIntegrationTest   : Starting CoreEntityIntegrationTest using Java 25.0.1 with PID 31296 (started by Ahzam Ali in D:\e-workspace\StoreFront-v2\server)
2026-01-15T16:12:56.445+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.CoreEntityIntegrationTest   : No active profile set, falling back to 1 default profile: "default"
2026-01-15T16:12:56.563+05:30  INFO 31296 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-15T16:12:56.581+05:30  INFO 31296 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 17 ms. Found 11 JPA repository interfaces.
2026-01-15T16:12:56.641+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-3 - Starting...
2026-01-15T16:12:56.717+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-3 - Added connection conn20: url=jdbc:h2:file:./data/storefront user=SA
2026-01-15T16:12:56.717+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-3 - Start completed.
2026-01-15T16:12:56.723+05:30  INFO 31296 --- [storefront-server] [           main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:file:./data/storefront (H2 2.2)
2026-01-15T16:12:56.725+05:30  WARN 31296 --- [storefront-server] [           main] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-15T16:12:56.729+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbValidate     : Successfully validated 3 migrations (execution time 00:00.003s)
2026-01-15T16:12:56.731+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": 5
2026-01-15T16:12:56.732+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Schema "PUBLIC" is up to date. No migration necessary.
2026-01-15T16:12:56.741+05:30  INFO 31296 --- [storefront-server] [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-15T16:12:56.743+05:30  INFO 31296 --- [storefront-server] [           main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-15T16:12:56.746+05:30  INFO 31296 --- [storefront-server] [           main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-15T16:12:56.747+05:30  WARN 31296 --- [storefront-server] [           main] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-15T16:12:56.865+05:30  INFO 31296 --- [storefront-server] [           main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-15T16:12:56.872+05:30  INFO 31296 --- [storefront-server] [           main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-15T16:12:56.877+05:30  WARN 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : JWT signing key initialized (NEW KEY GENERATED - all previous tokens are now invalid)
2026-01-15T16:12:57.066+05:30  WARN 31296 --- [storefront-server] [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-15T16:12:57.074+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.a.w.s.WelcomePageHandlerMapping    : Adding welcome page: class path resource [static/index.html]
2026-01-15T16:12:57.110+05:30  INFO 31296 --- [storefront-server] [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@5cd549ae, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@44535df8, org.springframework.security.web.context.SecurityContextHolderFilter@15f8b713, org.springframework.security.web.header.HeaderWriterFilter@68f2ccb2, org.springframework.web.filter.CorsFilter@4e5c1817, org.springframework.security.web.authentication.logout.LogoutFilter@3fe8a255, com.storefront.security.JwtAuthenticationFilter@6ae67bf6, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@6e79cc31, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@10101a10, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@456b4892, org.springframework.security.web.session.SessionManagementFilter@37a907cb, org.springframework.security.web.access.ExceptionTranslationFilter@4ce6f39e, org.springframework.security.web.access.intercept.AuthorizationFilter@2655ad3b]
2026-01-15T16:12:57.162+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:file:./data/storefront'
2026-01-15T16:12:57.173+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.CoreEntityIntegrationTest   : Started CoreEntityIntegrationTest in 0.743 seconds (process running for 9.572)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: insert into bundle (active,description,name,price,sku,id) values (?,?,?,?,?,default)
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,bi1_0.quantity from bundle_item bi1_0 join bundle b1_0 on b1_0.id=bi1_0.bundle_id join product p1_0 on p1_0.id=bi1_0.product_id where (bi1_0.bundle_id,bi1_0.product_id) in ((?,?))
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into bundle_item (quantity,bundle_id,product_id) values (?,?,?)
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: insert into customer_order (created_at,customer_id,discount,user_id,reconciled,status,store_id,total_amount,id) values (?,?,?,?,?,?,?,?,default)
Hibernate: insert into order_line (bundle_id,is_exclusion,order_id,product_id,quantity,unit_price,id) values (?,?,?,?,?,?,default)
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.804 s -- in com.storefront.CoreEntityIntegrationTest
[INFO] Running com.storefront.InventoryIntegrationTest
2026-01-15T16:12:57.230+05:30  INFO 31296 --- [storefront-server] [           main] t.c.s.AnnotationConfigContextLoaderUtils : Could not detect default configuration classes for test class [com.storefront.InventoryIntegrationTest]: InventoryIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2026-01-15T16:12:57.234+05:30  INFO 31296 --- [storefront-server] [           main] .b.t.c.SpringBootTestContextBootstrapper : Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.InventoryIntegrationTest

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.1)

2026-01-15T16:12:57.255+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.InventoryIntegrationTest    : Starting InventoryIntegrationTest using Java 25.0.1 with PID 31296 (started by Ahzam Ali in D:\e-workspace\StoreFront-v2\server)
2026-01-15T16:12:57.256+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.InventoryIntegrationTest    : No active profile set, falling back to 1 default profile: "default"
2026-01-15T16:12:57.376+05:30  INFO 31296 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-15T16:12:57.390+05:30  INFO 31296 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 14 ms. Found 11 JPA repository interfaces.
2026-01-15T16:12:57.442+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-4 - Starting...
2026-01-15T16:12:57.444+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-4 - Added connection conn30: url=jdbc:h2:mem:testdb_inv user=SA
2026-01-15T16:12:57.444+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-4 - Start completed.
2026-01-15T16:12:57.451+05:30  INFO 31296 --- [storefront-server] [           main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:testdb_inv (H2 2.2)
2026-01-15T16:12:57.452+05:30  WARN 31296 --- [storefront-server] [           main] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-15T16:12:57.455+05:30  INFO 31296 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-15T16:12:57.456+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbValidate     : Successfully validated 3 migrations (execution time 00:00.002s)
2026-01-15T16:12:57.456+05:30  INFO 31296 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-15T16:12:57.459+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-15T16:12:57.463+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - init schema"
2026-01-15T16:12:57.472+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "4 - add reconciliation log"
2026-01-15T16:12:57.477+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - add product is active"
2026-01-15T16:12:57.482+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Successfully applied 3 migrations to schema "PUBLIC", now at version v5 (execution time 00:00.010s)
2026-01-15T16:12:57.497+05:30  INFO 31296 --- [storefront-server] [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-15T16:12:57.499+05:30  INFO 31296 --- [storefront-server] [           main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-15T16:12:57.502+05:30  INFO 31296 --- [storefront-server] [           main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-15T16:12:57.503+05:30  WARN 31296 --- [storefront-server] [           main] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-15T16:12:57.617+05:30  INFO 31296 --- [storefront-server] [           main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
Hibernate: alter table if exists bundle alter column price set data type numeric(38,2)
Hibernate: create table customer (id bigint generated by default as identity, created_at timestamp(6), name varchar(255) not null, phone varchar(255) not null, primary key (id))
Hibernate: alter table if exists customer_order alter column total_amount set data type numeric(38,2)
Hibernate: alter table if exists customer_order add column customer_id bigint
Hibernate: alter table if exists order_line alter column unit_price set data type numeric(38,2)
Hibernate: alter table if exists product alter column base_price set data type numeric(38,2)
Hibernate: alter table if exists reconciliation_log alter column total_revenue set data type numeric(38,2)
Hibernate: alter table if exists customer drop constraint if exists UK_o3uty20c6csmx5y4uk2tc5r4m
Hibernate: alter table if exists customer add constraint UK_o3uty20c6csmx5y4uk2tc5r4m unique (phone)
Hibernate: alter table if exists customer_order add constraint FKf9abd30bhiqvugayxlpq8ryq9 foreign key (customer_id) references customer
2026-01-15T16:12:57.636+05:30  INFO 31296 --- [storefront-server] [           main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-15T16:12:57.639+05:30  WARN 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : JWT signing key initialized (NEW KEY GENERATED - all previous tokens are now invalid)
2026-01-15T16:12:57.794+05:30  WARN 31296 --- [storefront-server] [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-15T16:12:57.802+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.a.w.s.WelcomePageHandlerMapping    : Adding welcome page: class path resource [static/index.html]
2026-01-15T16:12:57.829+05:30  INFO 31296 --- [storefront-server] [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@2b16efeb, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@6be4686b, org.springframework.security.web.context.SecurityContextHolderFilter@128921c4, org.springframework.security.web.header.HeaderWriterFilter@35db3ea2, org.springframework.web.filter.CorsFilter@7d440b1f, org.springframework.security.web.authentication.logout.LogoutFilter@680410ec, com.storefront.security.JwtAuthenticationFilter@366ed5c7, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@4eb870be, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@227a79e5, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@769229cb, org.springframework.security.web.session.SessionManagementFilter@2c27e36, org.springframework.security.web.access.ExceptionTranslationFilter@30dd9615, org.springframework.security.web.access.intercept.AuthorizationFilter@63dd100c]
2026-01-15T16:12:57.908+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:testdb_inv'
2026-01-15T16:12:57.918+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.t.m.w.SpringBootMockServletContext : Initializing Spring TestDispatcherServlet ''
2026-01-15T16:12:57.918+05:30  INFO 31296 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Initializing Servlet ''
2026-01-15T16:12:57.918+05:30  INFO 31296 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Completed initialization in 0 ms
2026-01-15T16:12:57.926+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.InventoryIntegrationTest    : Started InventoryIntegrationTest in 0.685 seconds (process running for 10.325)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
2026-01-15T16:12:58.145+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:12:58.147+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_inv, Role: ADMIN, Authority: ROLE_ADMIN
2026-01-15T16:12:58.152+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:12:58.156+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: emp_inv, Role: EMPLOYEE, Authority: ROLE_EMPLOYEE
Hibernate: update product set attributes=?,base_price=?,is_active=?,name=?,sku=?,type=? where id=?
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.is_active
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
2026-01-15T16:12:58.321+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:12:58.324+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_inv, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
2026-01-15T16:12:58.339+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:12:58.341+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: emp_inv, Role: EMPLOYEE, Authority: ROLE_EMPLOYEE
2026-01-15T16:12:58.343+05:30 ERROR 31296 --- [storefront-server] [           main] com.storefront.config.SecurityConfig     : Access DENIED for POST /api/v1/inventory/products - User: UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=emp_inv, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_EMPLOYEE]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=127.0.0.1, SessionId=null], Granted Authorities=[ROLE_EMPLOYEE]], Error: Access Denied
2026-01-15T16:12:58.347+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:12:58.349+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_inv, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: insert into bundle (active,description,name,price,sku,id) values (?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,bi1_0.quantity from bundle_item bi1_0 join bundle b1_0 on b1_0.id=bi1_0.bundle_id join product p1_0 on p1_0.id=bi1_0.product_id where (bi1_0.bundle_id,bi1_0.product_id) in ((?,?))
2026-01-15T16:12:58.365+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:12:58.367+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_inv, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
2026-01-15T16:12:58.387+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:12:58.389+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_inv, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku from bundle b1_0
Hibernate: insert into bundle_item (quantity,bundle_id,product_id) values (?,?,?)
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,bi1_0.quantity from bundle_item bi1_0 left join bundle b1_0 on b1_0.id=bi1_0.bundle_id where b1_0.id=?
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.179 s -- in com.storefront.InventoryIntegrationTest
[INFO] Running com.storefront.InventorySearchIntegrationTest
2026-01-15T16:12:58.409+05:30  INFO 31296 --- [storefront-server] [           main] t.c.s.AnnotationConfigContextLoaderUtils : Could not detect default configuration classes for test class [com.storefront.InventorySearchIntegrationTest]: InventorySearchIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2026-01-15T16:12:58.411+05:30  INFO 31296 --- [storefront-server] [           main] .b.t.c.SpringBootTestContextBootstrapper : Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.InventorySearchIntegrationTest

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.1)

2026-01-15T16:12:58.425+05:30  INFO 31296 --- [storefront-server] [           main] c.s.InventorySearchIntegrationTest       : Starting InventorySearchIntegrationTest using Java 25.0.1 with PID 31296 (started by Ahzam Ali in D:\e-workspace\StoreFront-v2\server)
2026-01-15T16:12:58.425+05:30  INFO 31296 --- [storefront-server] [           main] c.s.InventorySearchIntegrationTest       : No active profile set, falling back to 1 default profile: "default"
2026-01-15T16:12:58.521+05:30  INFO 31296 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-15T16:12:58.534+05:30  INFO 31296 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 12 ms. Found 11 JPA repository interfaces.
2026-01-15T16:12:58.584+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-5 - Starting...
2026-01-15T16:12:58.586+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-5 - Added connection conn40: url=jdbc:h2:mem:testdb user=SA
2026-01-15T16:12:58.586+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-5 - Start completed.
2026-01-15T16:12:58.591+05:30  INFO 31296 --- [storefront-server] [           main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:testdb (H2 2.2)
2026-01-15T16:12:58.591+05:30  WARN 31296 --- [storefront-server] [           main] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-15T16:12:58.594+05:30  INFO 31296 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-15T16:12:58.595+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbValidate     : Successfully validated 3 migrations (execution time 00:00.002s)
2026-01-15T16:12:58.596+05:30  INFO 31296 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-15T16:12:58.599+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-15T16:12:58.602+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - init schema"
2026-01-15T16:12:58.609+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "4 - add reconciliation log"
2026-01-15T16:12:58.612+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - add product is active"
2026-01-15T16:12:58.615+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Successfully applied 3 migrations to schema "PUBLIC", now at version v5 (execution time 00:00.006s)
2026-01-15T16:12:58.625+05:30  INFO 31296 --- [storefront-server] [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-15T16:12:58.628+05:30  INFO 31296 --- [storefront-server] [           main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-15T16:12:58.631+05:30  INFO 31296 --- [storefront-server] [           main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-15T16:12:58.632+05:30  WARN 31296 --- [storefront-server] [           main] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-15T16:12:58.753+05:30  INFO 31296 --- [storefront-server] [           main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
Hibernate: alter table if exists bundle alter column price set data type numeric(38,2)
Hibernate: create table customer (id bigint generated by default as identity, created_at timestamp(6), name varchar(255) not null, phone varchar(255) not null, primary key (id))
Hibernate: alter table if exists customer_order alter column total_amount set data type numeric(38,2)
Hibernate: alter table if exists customer_order add column customer_id bigint
Hibernate: alter table if exists order_line alter column unit_price set data type numeric(38,2)
Hibernate: alter table if exists product alter column base_price set data type numeric(38,2)
Hibernate: alter table if exists reconciliation_log alter column total_revenue set data type numeric(38,2)
Hibernate: alter table if exists customer drop constraint if exists UK_o3uty20c6csmx5y4uk2tc5r4m
Hibernate: alter table if exists customer add constraint UK_o3uty20c6csmx5y4uk2tc5r4m unique (phone)
Hibernate: alter table if exists customer_order add constraint FKf9abd30bhiqvugayxlpq8ryq9 foreign key (customer_id) references customer
2026-01-15T16:12:58.768+05:30  INFO 31296 --- [storefront-server] [           main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-15T16:12:58.769+05:30  WARN 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : JWT signing key initialized (NEW KEY GENERATED - all previous tokens are now invalid)
2026-01-15T16:12:58.887+05:30  WARN 31296 --- [storefront-server] [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-15T16:12:58.893+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.a.w.s.WelcomePageHandlerMapping    : Adding welcome page: class path resource [static/index.html]
2026-01-15T16:12:58.916+05:30  INFO 31296 --- [storefront-server] [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@6bd9a104, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@5307fee, org.springframework.security.web.context.SecurityContextHolderFilter@704588fc, org.springframework.security.web.header.HeaderWriterFilter@43b5274e, org.springframework.web.filter.CorsFilter@47a2d9a9, org.springframework.security.web.authentication.logout.LogoutFilter@25cff0, com.storefront.security.JwtAuthenticationFilter@2544e8bf, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@6450bea7, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@e357a34, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@6fc7c08f, org.springframework.security.web.session.SessionManagementFilter@40d259d0, org.springframework.security.web.access.ExceptionTranslationFilter@43caf97a, org.springframework.security.web.access.intercept.AuthorizationFilter@45adac0e]
2026-01-15T16:12:58.956+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:testdb'
2026-01-15T16:12:58.965+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.t.m.w.SpringBootMockServletContext : Initializing Spring TestDispatcherServlet ''
2026-01-15T16:12:58.965+05:30  INFO 31296 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Initializing Servlet ''
2026-01-15T16:12:58.965+05:30  INFO 31296 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Completed initialization in 0 ms
2026-01-15T16:12:58.968+05:30  INFO 31296 --- [storefront-server] [           main] c.s.InventorySearchIntegrationTest       : Started InventorySearchIntegrationTest in 0.555 seconds (process running for 11.368)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
2026-01-15T16:12:59.113+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:12:59.116+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: inv_search_admin, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
2026-01-15T16:12:59.154+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:12:59.156+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: inv_search_admin, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
2026-01-15T16:12:59.170+05:30 ERROR 31296 --- [storefront-server] [           main] com.storefront.config.SecurityConfig     : Access DENIED for POST /api/v1/stores/2/allocate - User: UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=inv_search_admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=127.0.0.1, SessionId=null], Granted Authorities=[ROLE_ADMIN]], Error: User does not have access to this store

MockHttpServletRequest:
      HTTP Method = POST
      Request URI = /api/v1/stores
       Parameters = {}
          Headers = [Content-Type:"application/json;charset=UTF-8", Authorization:"Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJpbnZfc2VhcmNoX2FkbWluIiwicm9sZSI6IkFETUlOIiwidXNlcklkIjoyLCJpYXQiOjE3Njg0NzM3NzksImV4cCI6MTc2ODQ3NzM3OX0.W-wfxuVGIKRJGzQKsaMt9Se4smmBi348qWR_DEQFzv_pcbX__tMdLefUl2bnENlyYwCd8iEu_COGPH_tH2mgFA", Content-Length:"23"]
             Body = {"name":"Search Store"}
    Session Attrs = {}

Handler:
             Type = com.storefront.controller.StoreController
           Method = com.storefront.controller.StoreController#createStore(Map)

Async:
    Async started = false
     Async result = null

Resolved Exception:
             Type = null

ModelAndView:
        View name = null
             View = null
            Model = null

FlashMap:
       Attributes = null

MockHttpServletResponse:
           Status = 200
    Error message = null
          Headers = [Vary:"Origin", "Access-Control-Request-Method", "Access-Control-Request-Headers", Content-Type:"application/json", X-Content-Type-Options:"nosniff", X-XSS-Protection:"0", Cache-Control:"no-cache, no-store, max-age=0, must-revalidate", Pragma:"no-cache", Expires:"0"]
     Content type = application/json
             Body = {"id":2,"name":"Search Store","type":"VIRTUAL","currentOwner":null,"createdAt":"2026-01-15T16:12:59.120211"}
    Forwarded URL = null
   Redirected URL = null
          Cookies = []

MockHttpServletRequest:
      HTTP Method = POST
      Request URI = /api/v1/stores/2/allocate
       Parameters = {}
          Headers = [Content-Type:"application/json;charset=UTF-8", Authorization:"Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJpbnZfc2VhcmNoX2FkbWluIiwicm9sZSI6IkFETUlOIiwidXNlcklkIjoyLCJpYXQiOjE3Njg0NzM3NzksImV4cCI6MTc2ODQ3NzM3OX0.W-wfxuVGIKRJGzQKsaMt9Se4smmBi348qWR_DEQFzv_pcbX__tMdLefUl2bnENlyYwCd8iEu_COGPH_tH2mgFA", Content-Length:"44"]
             Body = {"items":[{"sku":"ISBN-111","quantity":10}]}
    Session Attrs = {}

Handler:
             Type = com.storefront.controller.StoreController
           Method = com.storefront.controller.StoreController#allocate(Long, AllocationRequestDTO, UserDetails)

Async:
    Async started = false
     Async result = null

Resolved Exception:
             Type = null

ModelAndView:
        View name = null
             View = null
            Model = null

FlashMap:
       Attributes = null

MockHttpServletResponse:
           Status = 403
    Error message = User does not have access to this store
          Headers = [Vary:"Origin", "Access-Control-Request-Method", "Access-Control-Request-Headers", X-Content-Type-Options:"nosniff", X-XSS-Protection:"0", Cache-Control:"no-cache, no-store, max-age=0, must-revalidate", Pragma:"no-cache", Expires:"0"]
     Content type = null
             Body = 
    Forwarded URL = null
   Redirected URL = null
          Cookies = []
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
2026-01-15T16:12:59.248+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:12:59.250+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: inv_search_admin, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
2026-01-15T16:12:59.277+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:12:59.279+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: inv_search_admin, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
2026-01-15T16:12:59.285+05:30 ERROR 31296 --- [storefront-server] [           main] com.storefront.config.SecurityConfig     : Access DENIED for POST /api/v1/stores/3/allocate - User: UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=inv_search_admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=127.0.0.1, SessionId=null], Granted Authorities=[ROLE_ADMIN]], Error: User does not have access to this store

MockHttpServletRequest:
      HTTP Method = POST
      Request URI = /api/v1/stores
       Parameters = {}
          Headers = [Content-Type:"application/json;charset=UTF-8", Authorization:"Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJpbnZfc2VhcmNoX2FkbWluIiwicm9sZSI6IkFETUlOIiwidXNlcklkIjozLCJpYXQiOjE3Njg0NzM3NzksImV4cCI6MTc2ODQ3NzM3OX0.GBGh0ewhI3FjhPVrjBfi6BGyHHOzQJTio5YAt5Q1jaZNieD0z8RQx2ugQu4Pe-9VgRzALF6HHPuLrxzf1ihOsQ", Content-Length:"23"]
             Body = {"name":"Search Store"}
    Session Attrs = {}

Handler:
             Type = com.storefront.controller.StoreController
           Method = com.storefront.controller.StoreController#createStore(Map)

Async:
    Async started = false
     Async result = null

Resolved Exception:
             Type = null

ModelAndView:
        View name = null
             View = null
            Model = null

FlashMap:
       Attributes = null

MockHttpServletResponse:
           Status = 200
    Error message = null
          Headers = [Vary:"Origin", "Access-Control-Request-Method", "Access-Control-Request-Headers", Content-Type:"application/json", X-Content-Type-Options:"nosniff", X-XSS-Protection:"0", Cache-Control:"no-cache, no-store, max-age=0, must-revalidate", Pragma:"no-cache", Expires:"0"]
     Content type = application/json
             Body = {"id":3,"name":"Search Store","type":"VIRTUAL","currentOwner":null,"createdAt":"2026-01-15T16:12:59.25174"}
    Forwarded URL = null
   Redirected URL = null
          Cookies = []

MockHttpServletRequest:
      HTTP Method = POST
      Request URI = /api/v1/stores/3/allocate
       Parameters = {}
          Headers = [Content-Type:"application/json;charset=UTF-8", Authorization:"Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJpbnZfc2VhcmNoX2FkbWluIiwicm9sZSI6IkFETUlOIiwidXNlcklkIjozLCJpYXQiOjE3Njg0NzM3NzksImV4cCI6MTc2ODQ3NzM3OX0.GBGh0ewhI3FjhPVrjBfi6BGyHHOzQJTio5YAt5Q1jaZNieD0z8RQx2ugQu4Pe-9VgRzALF6HHPuLrxzf1ihOsQ", Content-Length:"44"]
             Body = {"items":[{"sku":"ISBN-111","quantity":10}]}
    Session Attrs = {}

Handler:
             Type = com.storefront.controller.StoreController
           Method = com.storefront.controller.StoreController#allocate(Long, AllocationRequestDTO, UserDetails)

Async:
    Async started = false
     Async result = null

Resolved Exception:
             Type = null

ModelAndView:
        View name = null
             View = null
            Model = null

FlashMap:
       Attributes = null

MockHttpServletResponse:
           Status = 403
    Error message = User does not have access to this store
          Headers = [Vary:"Origin", "Access-Control-Request-Method", "Access-Control-Request-Headers", X-Content-Type-Options:"nosniff", X-XSS-Protection:"0", Cache-Control:"no-cache, no-store, max-age=0, must-revalidate", Pragma:"no-cache", Expires:"0"]
     Content type = null
             Body = 
    Forwarded URL = null
   Redirected URL = null
          Cookies = []
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
2026-01-15T16:12:59.363+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:12:59.366+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: inv_search_admin, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
2026-01-15T16:12:59.388+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:12:59.390+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: inv_search_admin, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
2026-01-15T16:12:59.395+05:30 ERROR 31296 --- [storefront-server] [           main] com.storefront.config.SecurityConfig     : Access DENIED for POST /api/v1/stores/4/allocate - User: UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=inv_search_admin, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=127.0.0.1, SessionId=null], Granted Authorities=[ROLE_ADMIN]], Error: User does not have access to this store

MockHttpServletRequest:
      HTTP Method = POST
      Request URI = /api/v1/stores
       Parameters = {}
          Headers = [Content-Type:"application/json;charset=UTF-8", Authorization:"Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJpbnZfc2VhcmNoX2FkbWluIiwicm9sZSI6IkFETUlOIiwidXNlcklkIjo0LCJpYXQiOjE3Njg0NzM3NzksImV4cCI6MTc2ODQ3NzM3OX0.wiYjCkI4je7p28hrEWUe78TF3Isocf9SHndeuAWZKAI59q7BrFyZOxJQQdsrbOhcMwU-oPNPTdn-fcgJfziwmA", Content-Length:"23"]
             Body = {"name":"Search Store"}
    Session Attrs = {}

Handler:
             Type = com.storefront.controller.StoreController
           Method = com.storefront.controller.StoreController#createStore(Map)

Async:
    Async started = false
     Async result = null

Resolved Exception:
             Type = null

ModelAndView:
        View name = null
             View = null
            Model = null

FlashMap:
       Attributes = null

MockHttpServletResponse:
           Status = 200
    Error message = null
          Headers = [Vary:"Origin", "Access-Control-Request-Method", "Access-Control-Request-Headers", Content-Type:"application/json", X-Content-Type-Options:"nosniff", X-XSS-Protection:"0", Cache-Control:"no-cache, no-store, max-age=0, must-revalidate", Pragma:"no-cache", Expires:"0"]
     Content type = application/json
             Body = {"id":4,"name":"Search Store","type":"VIRTUAL","currentOwner":null,"createdAt":"2026-01-15T16:12:59.367589"}
    Forwarded URL = null
   Redirected URL = null
          Cookies = []

MockHttpServletRequest:
      HTTP Method = POST
      Request URI = /api/v1/stores/4/allocate
       Parameters = {}
          Headers = [Content-Type:"application/json;charset=UTF-8", Authorization:"Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJpbnZfc2VhcmNoX2FkbWluIiwicm9sZSI6IkFETUlOIiwidXNlcklkIjo0LCJpYXQiOjE3Njg0NzM3NzksImV4cCI6MTc2ODQ3NzM3OX0.wiYjCkI4je7p28hrEWUe78TF3Isocf9SHndeuAWZKAI59q7BrFyZOxJQQdsrbOhcMwU-oPNPTdn-fcgJfziwmA", Content-Length:"44"]
             Body = {"items":[{"sku":"ISBN-111","quantity":10}]}
    Session Attrs = {}

Handler:
             Type = com.storefront.controller.StoreController
           Method = com.storefront.controller.StoreController#allocate(Long, AllocationRequestDTO, UserDetails)

Async:
    Async started = false
     Async result = null

Resolved Exception:
             Type = null

ModelAndView:
        View name = null
             View = null
            Model = null

FlashMap:
       Attributes = null

MockHttpServletResponse:
           Status = 403
    Error message = User does not have access to this store
          Headers = [Vary:"Origin", "Access-Control-Request-Method", "Access-Control-Request-Headers", X-Content-Type-Options:"nosniff", X-XSS-Protection:"0", Cache-Control:"no-cache, no-store, max-age=0, must-revalidate", Pragma:"no-cache", Expires:"0"]
     Content type = null
             Body = 
    Forwarded URL = null
   Redirected URL = null
          Cookies = []
[ERROR] Tests run: 3, Failures: 3, Errors: 0, Skipped: 0, Time elapsed: 0.990 s <<< FAILURE! -- in com.storefront.InventorySearchIntegrationTest
[ERROR] com.storefront.InventorySearchIntegrationTest.testSearchInventoryByIsbn -- Time elapsed: 0.129 s <<< FAILURE!
java.lang.AssertionError: Status expected:<200> but was:<403>
	at org.springframework.test.util.AssertionErrors.fail(AssertionErrors.java:59)
	at org.springframework.test.util.AssertionErrors.assertEquals(AssertionErrors.java:122)
	at org.springframework.test.web.servlet.result.StatusResultMatchers.lambda$matcher$9(StatusResultMatchers.java:637)
	at org.springframework.test.web.servlet.MockMvc$1.andExpect(MockMvc.java:214)
	at com.storefront.InventorySearchIntegrationTest.allocateStock(InventorySearchIntegrationTest.java:147)
	at com.storefront.InventorySearchIntegrationTest.setUp(InventorySearchIntegrationTest.java:118)
	at java.base/java.lang.reflect.Method.invoke(Method.java:565)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)

[ERROR] com.storefront.InventorySearchIntegrationTest.testSearchInventoryByName -- Time elapsed: 0.114 s <<< FAILURE!
java.lang.AssertionError: Status expected:<200> but was:<403>
	at org.springframework.test.util.AssertionErrors.fail(AssertionErrors.java:59)
	at org.springframework.test.util.AssertionErrors.assertEquals(AssertionErrors.java:122)
	at org.springframework.test.web.servlet.result.StatusResultMatchers.lambda$matcher$9(StatusResultMatchers.java:637)
	at org.springframework.test.web.servlet.MockMvc$1.andExpect(MockMvc.java:214)
	at com.storefront.InventorySearchIntegrationTest.allocateStock(InventorySearchIntegrationTest.java:147)
	at com.storefront.InventorySearchIntegrationTest.setUp(InventorySearchIntegrationTest.java:118)
	at java.base/java.lang.reflect.Method.invoke(Method.java:565)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)

[ERROR] com.storefront.InventorySearchIntegrationTest.testSearchInventoryBySkuPart -- Time elapsed: 0.108 s <<< FAILURE!
java.lang.AssertionError: Status expected:<200> but was:<403>
	at org.springframework.test.util.AssertionErrors.fail(AssertionErrors.java:59)
	at org.springframework.test.util.AssertionErrors.assertEquals(AssertionErrors.java:122)
	at org.springframework.test.web.servlet.result.StatusResultMatchers.lambda$matcher$9(StatusResultMatchers.java:637)
	at org.springframework.test.web.servlet.MockMvc$1.andExpect(MockMvc.java:214)
	at com.storefront.InventorySearchIntegrationTest.allocateStock(InventorySearchIntegrationTest.java:147)
	at com.storefront.InventorySearchIntegrationTest.setUp(InventorySearchIntegrationTest.java:118)
	at java.base/java.lang.reflect.Method.invoke(Method.java:565)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)

[INFO] Running com.storefront.OrderIntegrationTest
2026-01-15T16:12:59.400+05:30  INFO 31296 --- [storefront-server] [           main] t.c.s.AnnotationConfigContextLoaderUtils : Could not detect default configuration classes for test class [com.storefront.OrderIntegrationTest]: OrderIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2026-01-15T16:12:59.401+05:30  INFO 31296 --- [storefront-server] [           main] .b.t.c.SpringBootTestContextBootstrapper : Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.OrderIntegrationTest

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.1)

2026-01-15T16:12:59.417+05:30  INFO 31296 --- [storefront-server] [           main] com.storefront.OrderIntegrationTest      : Starting OrderIntegrationTest using Java 25.0.1 with PID 31296 (started by Ahzam Ali in D:\e-workspace\StoreFront-v2\server)
2026-01-15T16:12:59.417+05:30  INFO 31296 --- [storefront-server] [           main] com.storefront.OrderIntegrationTest      : No active profile set, falling back to 1 default profile: "default"
2026-01-15T16:12:59.529+05:30  INFO 31296 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-15T16:12:59.544+05:30  INFO 31296 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 13 ms. Found 11 JPA repository interfaces.
2026-01-15T16:12:59.587+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-6 - Starting...
2026-01-15T16:12:59.589+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-6 - Added connection conn50: url=jdbc:h2:mem:testdb_order user=SA
2026-01-15T16:12:59.589+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-6 - Start completed.
2026-01-15T16:12:59.593+05:30  INFO 31296 --- [storefront-server] [           main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:testdb_order (H2 2.2)
2026-01-15T16:12:59.594+05:30  WARN 31296 --- [storefront-server] [           main] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-15T16:12:59.597+05:30  INFO 31296 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-15T16:12:59.597+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbValidate     : Successfully validated 3 migrations (execution time 00:00.002s)
2026-01-15T16:12:59.598+05:30  INFO 31296 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-15T16:12:59.601+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-15T16:12:59.605+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - init schema"
2026-01-15T16:12:59.610+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "4 - add reconciliation log"
2026-01-15T16:12:59.613+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - add product is active"
2026-01-15T16:12:59.617+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Successfully applied 3 migrations to schema "PUBLIC", now at version v5 (execution time 00:00.006s)
2026-01-15T16:12:59.632+05:30  INFO 31296 --- [storefront-server] [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-15T16:12:59.633+05:30  INFO 31296 --- [storefront-server] [           main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-15T16:12:59.635+05:30  INFO 31296 --- [storefront-server] [           main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-15T16:12:59.636+05:30  WARN 31296 --- [storefront-server] [           main] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-15T16:12:59.735+05:30  INFO 31296 --- [storefront-server] [           main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
Hibernate: alter table if exists bundle alter column price set data type numeric(38,2)
Hibernate: create table customer (id bigint generated by default as identity, created_at timestamp(6), name varchar(255) not null, phone varchar(255) not null, primary key (id))
Hibernate: alter table if exists customer_order alter column total_amount set data type numeric(38,2)
Hibernate: alter table if exists customer_order add column customer_id bigint
Hibernate: alter table if exists order_line alter column unit_price set data type numeric(38,2)
Hibernate: alter table if exists product alter column base_price set data type numeric(38,2)
Hibernate: alter table if exists reconciliation_log alter column total_revenue set data type numeric(38,2)
Hibernate: alter table if exists customer drop constraint if exists UK_o3uty20c6csmx5y4uk2tc5r4m
Hibernate: alter table if exists customer add constraint UK_o3uty20c6csmx5y4uk2tc5r4m unique (phone)
Hibernate: alter table if exists customer_order add constraint FKf9abd30bhiqvugayxlpq8ryq9 foreign key (customer_id) references customer
2026-01-15T16:12:59.748+05:30  INFO 31296 --- [storefront-server] [           main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-15T16:12:59.751+05:30  WARN 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : JWT signing key initialized (NEW KEY GENERATED - all previous tokens are now invalid)
2026-01-15T16:12:59.865+05:30  WARN 31296 --- [storefront-server] [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-15T16:12:59.877+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.a.w.s.WelcomePageHandlerMapping    : Adding welcome page: class path resource [static/index.html]
2026-01-15T16:12:59.901+05:30  INFO 31296 --- [storefront-server] [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@1f9d6cb3, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@61a7ed9c, org.springframework.security.web.context.SecurityContextHolderFilter@2a3920fe, org.springframework.security.web.header.HeaderWriterFilter@338a9b84, org.springframework.web.filter.CorsFilter@5fa9a360, org.springframework.security.web.authentication.logout.LogoutFilter@7b29b052, com.storefront.security.JwtAuthenticationFilter@53e0c50, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@3cf3216c, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@5bc2dbcd, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@7110c51e, org.springframework.security.web.session.SessionManagementFilter@477090bf, org.springframework.security.web.access.ExceptionTranslationFilter@57d8308d, org.springframework.security.web.access.intercept.AuthorizationFilter@2980f2f1]
2026-01-15T16:12:59.954+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:testdb_order'
2026-01-15T16:12:59.964+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.t.m.w.SpringBootMockServletContext : Initializing Spring TestDispatcherServlet ''
2026-01-15T16:12:59.965+05:30  INFO 31296 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Initializing Servlet ''
2026-01-15T16:12:59.965+05:30  INFO 31296 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Completed initialization in 0 ms
2026-01-15T16:12:59.968+05:30  INFO 31296 --- [storefront-server] [           main] com.storefront.OrderIntegrationTest      : Started OrderIntegrationTest in 0.566 seconds (process running for 12.368)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into bundle (active,description,name,price,sku,id) values (?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,bi1_0.quantity from bundle_item bi1_0 join bundle b1_0 on b1_0.id=bi1_0.bundle_id join product p1_0 on p1_0.id=bi1_0.product_id where (bi1_0.bundle_id,bi1_0.product_id) in ((?,?))
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,bi1_0.quantity from bundle_item bi1_0 join bundle b1_0 on b1_0.id=bi1_0.bundle_id join product p1_0 on p1_0.id=bi1_0.product_id where (bi1_0.bundle_id,bi1_0.product_id) in ((?,?))
Hibernate: insert into bundle_item (quantity,bundle_id,product_id) values (?,?,?)
Hibernate: insert into bundle_item (quantity,bundle_id,product_id) values (?,?,?)
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into bundle (active,description,name,price,sku,id) values (?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,bi1_0.quantity from bundle_item bi1_0 join bundle b1_0 on b1_0.id=bi1_0.bundle_id join product p1_0 on p1_0.id=bi1_0.product_id where (bi1_0.bundle_id,bi1_0.product_id) in ((?,?))
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,bi1_0.quantity from bundle_item bi1_0 join bundle b1_0 on b1_0.id=bi1_0.bundle_id join product p1_0 on p1_0.id=bi1_0.product_id where (bi1_0.bundle_id,bi1_0.product_id) in ((?,?))
Hibernate: insert into bundle_item (quantity,bundle_id,product_id) values (?,?,?)
Hibernate: insert into bundle_item (quantity,bundle_id,product_id) values (?,?,?)
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into bundle (active,description,name,price,sku,id) values (?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,bi1_0.quantity from bundle_item bi1_0 join bundle b1_0 on b1_0.id=bi1_0.bundle_id join product p1_0 on p1_0.id=bi1_0.product_id where (bi1_0.bundle_id,bi1_0.product_id) in ((?,?))
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,bi1_0.quantity from bundle_item bi1_0 join bundle b1_0 on b1_0.id=bi1_0.bundle_id join product p1_0 on p1_0.id=bi1_0.product_id where (bi1_0.bundle_id,bi1_0.product_id) in ((?,?))
Hibernate: insert into bundle_item (quantity,bundle_id,product_id) values (?,?,?)
Hibernate: insert into bundle_item (quantity,bundle_id,product_id) values (?,?,?)
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
[ERROR] Tests run: 3, Failures: 0, Errors: 3, Skipped: 0, Time elapsed: 0.899 s <<< FAILURE! -- in com.storefront.OrderIntegrationTest
[ERROR] com.storefront.OrderIntegrationTest.testOrder_InvalidStore -- Time elapsed: 0.091 s <<< ERROR!
org.springframework.security.access.AccessDeniedException: User does not have access to this store
	at com.storefront.service.StoreService.allocateStock(StoreService.java:63)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
	at java.base/java.lang.reflect.Method.invoke(Method.java:565)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.storefront.service.StoreService$$SpringCGLIB$$0.allocateStock(<generated>)
	at com.storefront.OrderIntegrationTest.setup(OrderIntegrationTest.java:104)
	at java.base/java.lang.reflect.Method.invoke(Method.java:565)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)

[ERROR] com.storefront.OrderIntegrationTest.testOrderFlow -- Time elapsed: 0.080 s <<< ERROR!
org.springframework.security.access.AccessDeniedException: User does not have access to this store
	at com.storefront.service.StoreService.allocateStock(StoreService.java:63)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
	at java.base/java.lang.reflect.Method.invoke(Method.java:565)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.storefront.service.StoreService$$SpringCGLIB$$0.allocateStock(<generated>)
	at com.storefront.OrderIntegrationTest.setup(OrderIntegrationTest.java:104)
	at java.base/java.lang.reflect.Method.invoke(Method.java:565)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)

[ERROR] com.storefront.OrderIntegrationTest.testOrder_InsufficientStock -- Time elapsed: 0.082 s <<< ERROR!
org.springframework.security.access.AccessDeniedException: User does not have access to this store
	at com.storefront.service.StoreService.allocateStock(StoreService.java:63)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
	at java.base/java.lang.reflect.Method.invoke(Method.java:565)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.storefront.service.StoreService$$SpringCGLIB$$0.allocateStock(<generated>)
	at com.storefront.OrderIntegrationTest.setup(OrderIntegrationTest.java:104)
	at java.base/java.lang.reflect.Method.invoke(Method.java:565)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)

[INFO] Running com.storefront.ProductAttributesTest
2026-01-15T16:13:00.300+05:30  INFO 31296 --- [storefront-server] [           main] t.c.s.AnnotationConfigContextLoaderUtils : Could not detect default configuration classes for test class [com.storefront.ProductAttributesTest]: ProductAttributesTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2026-01-15T16:13:00.300+05:30  INFO 31296 --- [storefront-server] [           main] .b.t.c.SpringBootTestContextBootstrapper : Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.ProductAttributesTest
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.017 s -- in com.storefront.ProductAttributesTest
[INFO] Running com.storefront.SecurityIntegrationTest
2026-01-15T16:13:00.316+05:30  INFO 31296 --- [storefront-server] [           main] t.c.s.AnnotationConfigContextLoaderUtils : Could not detect default configuration classes for test class [com.storefront.SecurityIntegrationTest]: SecurityIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2026-01-15T16:13:00.317+05:30  INFO 31296 --- [storefront-server] [           main] .b.t.c.SpringBootTestContextBootstrapper : Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.SecurityIntegrationTest

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.1)

2026-01-15T16:13:00.326+05:30  INFO 31296 --- [storefront-server] [           main] com.storefront.SecurityIntegrationTest   : Starting SecurityIntegrationTest using Java 25.0.1 with PID 31296 (started by Ahzam Ali in D:\e-workspace\StoreFront-v2\server)
2026-01-15T16:13:00.326+05:30  INFO 31296 --- [storefront-server] [           main] com.storefront.SecurityIntegrationTest   : No active profile set, falling back to 1 default profile: "default"
2026-01-15T16:13:00.411+05:30  INFO 31296 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-15T16:13:00.422+05:30  INFO 31296 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 11 ms. Found 11 JPA repository interfaces.
2026-01-15T16:13:00.467+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-7 - Starting...
2026-01-15T16:13:00.470+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-7 - Added connection conn60: url=jdbc:h2:mem:testdb_sec user=SA
2026-01-15T16:13:00.470+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-7 - Start completed.
2026-01-15T16:13:00.476+05:30  INFO 31296 --- [storefront-server] [           main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:testdb_sec (H2 2.2)
2026-01-15T16:13:00.477+05:30  WARN 31296 --- [storefront-server] [           main] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-15T16:13:00.481+05:30  INFO 31296 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-15T16:13:00.481+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbValidate     : Successfully validated 3 migrations (execution time 00:00.002s)
2026-01-15T16:13:00.482+05:30  INFO 31296 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-15T16:13:00.485+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-15T16:13:00.489+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - init schema"
2026-01-15T16:13:00.496+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "4 - add reconciliation log"
2026-01-15T16:13:00.499+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - add product is active"
2026-01-15T16:13:00.502+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Successfully applied 3 migrations to schema "PUBLIC", now at version v5 (execution time 00:00.008s)
2026-01-15T16:13:00.522+05:30  INFO 31296 --- [storefront-server] [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-15T16:13:00.524+05:30  INFO 31296 --- [storefront-server] [           main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-15T16:13:00.526+05:30  INFO 31296 --- [storefront-server] [           main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-15T16:13:00.526+05:30  WARN 31296 --- [storefront-server] [           main] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-15T16:13:00.618+05:30  INFO 31296 --- [storefront-server] [           main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
Hibernate: alter table if exists bundle alter column price set data type numeric(38,2)
Hibernate: create table customer (id bigint generated by default as identity, created_at timestamp(6), name varchar(255) not null, phone varchar(255) not null, primary key (id))
Hibernate: alter table if exists customer_order alter column total_amount set data type numeric(38,2)
Hibernate: alter table if exists customer_order add column customer_id bigint
Hibernate: alter table if exists order_line alter column unit_price set data type numeric(38,2)
Hibernate: alter table if exists product alter column base_price set data type numeric(38,2)
Hibernate: alter table if exists reconciliation_log alter column total_revenue set data type numeric(38,2)
Hibernate: alter table if exists customer drop constraint if exists UK_o3uty20c6csmx5y4uk2tc5r4m
Hibernate: alter table if exists customer add constraint UK_o3uty20c6csmx5y4uk2tc5r4m unique (phone)
Hibernate: alter table if exists customer_order add constraint FKf9abd30bhiqvugayxlpq8ryq9 foreign key (customer_id) references customer
2026-01-15T16:13:00.631+05:30  INFO 31296 --- [storefront-server] [           main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-15T16:13:00.634+05:30  WARN 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : JWT signing key initialized (NEW KEY GENERATED - all previous tokens are now invalid)
2026-01-15T16:13:00.758+05:30  WARN 31296 --- [storefront-server] [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-15T16:13:00.765+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.a.w.s.WelcomePageHandlerMapping    : Adding welcome page: class path resource [static/index.html]
2026-01-15T16:13:00.785+05:30  INFO 31296 --- [storefront-server] [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@169043e3, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@2a428e3b, org.springframework.security.web.context.SecurityContextHolderFilter@ebfe707, org.springframework.security.web.header.HeaderWriterFilter@48e48923, org.springframework.web.filter.CorsFilter@69faebc2, org.springframework.security.web.authentication.logout.LogoutFilter@300f2857, com.storefront.security.JwtAuthenticationFilter@c624fdc, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@6c1f6481, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@5e45b0, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@12bbf99e, org.springframework.security.web.session.SessionManagementFilter@233c4b40, org.springframework.security.web.access.ExceptionTranslationFilter@70025801, org.springframework.security.web.access.intercept.AuthorizationFilter@5f1495c6]
2026-01-15T16:13:00.822+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:testdb_sec'
2026-01-15T16:13:00.829+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.t.m.w.SpringBootMockServletContext : Initializing Spring TestDispatcherServlet ''
2026-01-15T16:13:00.830+05:30  INFO 31296 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Initializing Servlet ''
2026-01-15T16:13:00.830+05:30  INFO 31296 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Completed initialization in 0 ms
2026-01-15T16:13:00.836+05:30  INFO 31296 --- [storefront-server] [           main] com.storefront.SecurityIntegrationTest   : Started SecurityIntegrationTest in 0.516 seconds (process running for 13.235)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: admin_sec
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: emp_sec
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
2026-01-15T16:13:01.043+05:30 ERROR 31296 --- [storefront-server] [           main] com.storefront.config.SecurityConfig     : Authentication failed for GET /api/v1/auth/users: Full authentication is required to access this resource
=== LOGIN DEBUG ===
Attempting login for username: admin_sec
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: emp_sec
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
2026-01-15T16:13:01.182+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:13:01.184+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: emp_sec, Role: EMPLOYEE, Authority: ROLE_EMPLOYEE
2026-01-15T16:13:01.184+05:30 ERROR 31296 --- [storefront-server] [           main] com.storefront.config.SecurityConfig     : Access DENIED for GET /api/v1/auth/users - User: UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=emp_sec, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_EMPLOYEE]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=127.0.0.1, SessionId=null], Granted Authorities=[ROLE_EMPLOYEE]], Error: Access Denied
=== LOGIN DEBUG ===
Attempting login for username: admin_sec
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: emp_sec
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
2026-01-15T16:13:01.324+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:13:01.326+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_sec, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: admin_sec
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: emp_sec
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
2026-01-15T16:13:01.529+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:13:01.532+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_sec, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
=== LOGIN DEBUG ===
Attempting login for username: admin_sec
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: emp_sec
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: ' OR '1'='1
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.361 s -- in com.storefront.SecurityIntegrationTest
[INFO] Running com.storefront.StoreIntegrationTest
2026-01-15T16:13:01.677+05:30  INFO 31296 --- [storefront-server] [           main] t.c.s.AnnotationConfigContextLoaderUtils : Could not detect default configuration classes for test class [com.storefront.StoreIntegrationTest]: StoreIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2026-01-15T16:13:01.679+05:30  INFO 31296 --- [storefront-server] [           main] .b.t.c.SpringBootTestContextBootstrapper : Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.StoreIntegrationTest

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.1)

2026-01-15T16:13:01.690+05:30  INFO 31296 --- [storefront-server] [           main] com.storefront.StoreIntegrationTest      : Starting StoreIntegrationTest using Java 25.0.1 with PID 31296 (started by Ahzam Ali in D:\e-workspace\StoreFront-v2\server)
2026-01-15T16:13:01.690+05:30  INFO 31296 --- [storefront-server] [           main] com.storefront.StoreIntegrationTest      : No active profile set, falling back to 1 default profile: "default"
2026-01-15T16:13:01.772+05:30  INFO 31296 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-15T16:13:01.784+05:30  INFO 31296 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 11 ms. Found 11 JPA repository interfaces.
2026-01-15T16:13:01.818+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-8 - Starting...
2026-01-15T16:13:01.819+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-8 - Added connection conn70: url=jdbc:h2:mem:testdb_store user=SA
2026-01-15T16:13:01.819+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-8 - Start completed.
2026-01-15T16:13:01.822+05:30  INFO 31296 --- [storefront-server] [           main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:testdb_store (H2 2.2)
2026-01-15T16:13:01.822+05:30  WARN 31296 --- [storefront-server] [           main] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-15T16:13:01.824+05:30  INFO 31296 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-15T16:13:01.824+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbValidate     : Successfully validated 3 migrations (execution time 00:00.001s)
2026-01-15T16:13:01.824+05:30  INFO 31296 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-15T16:13:01.828+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-15T16:13:01.836+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - init schema"
2026-01-15T16:13:01.842+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "4 - add reconciliation log"
2026-01-15T16:13:01.845+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - add product is active"
2026-01-15T16:13:01.847+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Successfully applied 3 migrations to schema "PUBLIC", now at version v5 (execution time 00:00.005s)
2026-01-15T16:13:01.856+05:30  INFO 31296 --- [storefront-server] [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-15T16:13:01.857+05:30  INFO 31296 --- [storefront-server] [           main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-15T16:13:01.859+05:30  INFO 31296 --- [storefront-server] [           main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-15T16:13:01.859+05:30  WARN 31296 --- [storefront-server] [           main] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-15T16:13:01.960+05:30  INFO 31296 --- [storefront-server] [           main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
Hibernate: alter table if exists bundle alter column price set data type numeric(38,2)
Hibernate: create table customer (id bigint generated by default as identity, created_at timestamp(6), name varchar(255) not null, phone varchar(255) not null, primary key (id))
Hibernate: alter table if exists customer_order alter column total_amount set data type numeric(38,2)
Hibernate: alter table if exists customer_order add column customer_id bigint
Hibernate: alter table if exists order_line alter column unit_price set data type numeric(38,2)
Hibernate: alter table if exists product alter column base_price set data type numeric(38,2)
Hibernate: alter table if exists reconciliation_log alter column total_revenue set data type numeric(38,2)
Hibernate: alter table if exists customer drop constraint if exists UK_o3uty20c6csmx5y4uk2tc5r4m
Hibernate: alter table if exists customer add constraint UK_o3uty20c6csmx5y4uk2tc5r4m unique (phone)
Hibernate: alter table if exists customer_order add constraint FKf9abd30bhiqvugayxlpq8ryq9 foreign key (customer_id) references customer
2026-01-15T16:13:01.973+05:30  INFO 31296 --- [storefront-server] [           main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-15T16:13:01.975+05:30  WARN 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : JWT signing key initialized (NEW KEY GENERATED - all previous tokens are now invalid)
2026-01-15T16:13:02.100+05:30  WARN 31296 --- [storefront-server] [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-15T16:13:02.116+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.a.w.s.WelcomePageHandlerMapping    : Adding welcome page: class path resource [static/index.html]
2026-01-15T16:13:02.140+05:30  INFO 31296 --- [storefront-server] [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@2c567743, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@66dcab95, org.springframework.security.web.context.SecurityContextHolderFilter@6a78b0f3, org.springframework.security.web.header.HeaderWriterFilter@49accbb4, org.springframework.web.filter.CorsFilter@62bc8312, org.springframework.security.web.authentication.logout.LogoutFilter@5e8f1579, com.storefront.security.JwtAuthenticationFilter@7476a621, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@3c7b3bf6, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@1325b6a6, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@4cbb519f, org.springframework.security.web.session.SessionManagementFilter@b5d38bb, org.springframework.security.web.access.ExceptionTranslationFilter@3a0d9b19, org.springframework.security.web.access.intercept.AuthorizationFilter@ad48fbd]
2026-01-15T16:13:02.176+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:testdb_store'
2026-01-15T16:13:02.184+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.t.m.w.SpringBootMockServletContext : Initializing Spring TestDispatcherServlet ''
2026-01-15T16:13:02.184+05:30  INFO 31296 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Initializing Servlet ''
2026-01-15T16:13:02.184+05:30  INFO 31296 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Completed initialization in 0 ms
2026-01-15T16:13:02.186+05:30  INFO 31296 --- [storefront-server] [           main] com.storefront.StoreIntegrationTest      : Started StoreIntegrationTest in 0.505 seconds (process running for 14.586)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
2026-01-15T16:13:02.417+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:13:02.421+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: user_a, Role: STORE_ADMIN, Authority: ROLE_STORE_ADMIN

MockHttpServletRequest:
      HTTP Method = POST
      Request URI = /api/v1/stores/3/allocate
       Parameters = {}
          Headers = [Content-Type:"application/json;charset=UTF-8", Authorization:"Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJ1c2VyX2EiLCJyb2xlIjoiU1RPUkVfQURNSU4iLCJ1c2VySWQiOjMsImlhdCI6MTc2ODQ3Mzc4MiwiZXhwIjoxNzY4NDc3MzgyfQ.SXl8gGVJrRo-gvvL7Q1iX2CvFQlFEs5o8IzbaPeuEzFyAZwfrEB-vtSCDb2-yBldqp66hwzWND466E3--w6VBg", Content-Length:"12"]
             Body = {"items":[]}
    Session Attrs = {}

Handler:
             Type = com.storefront.controller.StoreController
           Method = com.storefront.controller.StoreController#allocate(Long, AllocationRequestDTO, UserDetails)

Async:
    Async started = false
     Async result = null

Resolved Exception:
             Type = org.springframework.web.bind.MethodArgumentNotValidException

ModelAndView:
        View name = null
             View = null
            Model = null

FlashMap:
       Attributes = null

MockHttpServletResponse:
           Status = 400
    Error message = null
          Headers = [Vary:"Origin", "Access-Control-Request-Method", "Access-Control-Request-Headers", Content-Type:"application/json", X-Content-Type-Options:"nosniff", X-XSS-Protection:"0", Cache-Control:"no-cache, no-store, max-age=0, must-revalidate", Pragma:"no-cache", Expires:"0"]
     Content type = application/json
             Body = {"items":"Items list cannot be empty"}
    Forwarded URL = null
   Redirected URL = null
          Cookies = []
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
2026-01-15T16:13:02.527+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:13:02.530+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_store, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
2026-01-15T16:13:02.539+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:13:02.541+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_store, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
2026-01-15T16:13:02.547+05:30 ERROR 31296 --- [storefront-server] [           main] com.storefront.config.SecurityConfig     : Access DENIED for POST /api/v1/stores/4/allocate - User: UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=admin_store, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_ADMIN]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=127.0.0.1, SessionId=null], Granted Authorities=[ROLE_ADMIN]], Error: User does not have access to this store

MockHttpServletRequest:
      HTTP Method = POST
      Request URI = /api/v1/stores
       Parameters = {}
          Headers = [Content-Type:"application/json;charset=UTF-8", Authorization:"Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbl9zdG9yZSIsInJvbGUiOiJBRE1JTiIsInVzZXJJZCI6NCwiaWF0IjoxNzY4NDczNzgyLCJleHAiOjE3Njg0NzczODJ9.FsjlGQzvS1tUu1U8cpYD4UoPapR8D5mkBZMbKlVUIUMx14Al_QDOrXvPj0b4px3eNKiotPYNoqWzxFbTVfQFrQ", Content-Length:"18"]
             Body = {"name":"PopUp 1"}
    Session Attrs = {}

Handler:
             Type = com.storefront.controller.StoreController
           Method = com.storefront.controller.StoreController#createStore(Map)

Async:
    Async started = false
     Async result = null

Resolved Exception:
             Type = null

ModelAndView:
        View name = null
             View = null
            Model = null

FlashMap:
       Attributes = null

MockHttpServletResponse:
           Status = 200
    Error message = null
          Headers = [Vary:"Origin", "Access-Control-Request-Method", "Access-Control-Request-Headers", Content-Type:"application/json", X-Content-Type-Options:"nosniff", X-XSS-Protection:"0", Cache-Control:"no-cache, no-store, max-age=0, must-revalidate", Pragma:"no-cache", Expires:"0"]
     Content type = application/json
             Body = {"id":4,"name":"PopUp 1","type":"VIRTUAL","currentOwner":null,"createdAt":"2026-01-15T16:13:02.533148"}
    Forwarded URL = null
   Redirected URL = null
          Cookies = []

MockHttpServletRequest:
      HTTP Method = POST
      Request URI = /api/v1/stores/4/allocate
       Parameters = {}
          Headers = [Content-Type:"application/json;charset=UTF-8", Authorization:"Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJhZG1pbl9zdG9yZSIsInJvbGUiOiJBRE1JTiIsInVzZXJJZCI6NCwiaWF0IjoxNzY4NDczNzgyLCJleHAiOjE3Njg0NzczODJ9.FsjlGQzvS1tUu1U8cpYD4UoPapR8D5mkBZMbKlVUIUMx14Al_QDOrXvPj0b4px3eNKiotPYNoqWzxFbTVfQFrQ", Content-Length:"46"]
             Body = {"items":[{"sku":"SKU-BOOK-1","quantity":20}]}
    Session Attrs = {}

Handler:
             Type = com.storefront.controller.StoreController
           Method = com.storefront.controller.StoreController#allocate(Long, AllocationRequestDTO, UserDetails)

Async:
    Async started = false
     Async result = null

Resolved Exception:
             Type = null

ModelAndView:
        View name = null
             View = null
            Model = null

FlashMap:
       Attributes = null

MockHttpServletResponse:
           Status = 403
    Error message = User does not have access to this store
          Headers = [Vary:"Origin", "Access-Control-Request-Method", "Access-Control-Request-Headers", X-Content-Type-Options:"nosniff", X-XSS-Protection:"0", Cache-Control:"no-cache, no-store, max-age=0, must-revalidate", Pragma:"no-cache", Expires:"0"]
     Content type = null
             Body = 
    Forwarded URL = null
   Redirected URL = null
          Cookies = []
[ERROR] Tests run: 2, Failures: 2, Errors: 0, Skipped: 0, Time elapsed: 0.874 s <<< FAILURE! -- in com.storefront.StoreIntegrationTest
[ERROR] com.storefront.StoreIntegrationTest.testStoreAccessBoundary -- Time elapsed: 0.177 s <<< FAILURE!
java.lang.AssertionError: Status expected:<403> but was:<400>
	at org.springframework.test.util.AssertionErrors.fail(AssertionErrors.java:59)
	at org.springframework.test.util.AssertionErrors.assertEquals(AssertionErrors.java:122)
	at org.springframework.test.web.servlet.result.StatusResultMatchers.lambda$matcher$9(StatusResultMatchers.java:637)
	at org.springframework.test.web.servlet.MockMvc$1.andExpect(MockMvc.java:214)
	at com.storefront.StoreIntegrationTest.testStoreAccessBoundary(StoreIntegrationTest.java:215)
	at java.base/java.lang.reflect.Method.invoke(Method.java:565)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)

[ERROR] com.storefront.StoreIntegrationTest.testAllocationAndReconciliation -- Time elapsed: 0.109 s <<< FAILURE!
java.lang.AssertionError: Status expected:<200> but was:<403>
	at org.springframework.test.util.AssertionErrors.fail(AssertionErrors.java:59)
	at org.springframework.test.util.AssertionErrors.assertEquals(AssertionErrors.java:122)
	at org.springframework.test.web.servlet.result.StatusResultMatchers.lambda$matcher$9(StatusResultMatchers.java:637)
	at org.springframework.test.web.servlet.MockMvc$1.andExpect(MockMvc.java:214)
	at com.storefront.StoreIntegrationTest.testAllocationAndReconciliation(StoreIntegrationTest.java:115)
	at java.base/java.lang.reflect.Method.invoke(Method.java:565)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)

[INFO] Running com.storefront.UserStoreAssignmentTest
2026-01-15T16:13:02.551+05:30  INFO 31296 --- [storefront-server] [           main] t.c.s.AnnotationConfigContextLoaderUtils : Could not detect default configuration classes for test class [com.storefront.UserStoreAssignmentTest]: UserStoreAssignmentTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2026-01-15T16:13:02.553+05:30  INFO 31296 --- [storefront-server] [           main] .b.t.c.SpringBootTestContextBootstrapper : Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.UserStoreAssignmentTest
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
[INFO] Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.034 s -- in com.storefront.UserStoreAssignmentTest
[INFO] Running com.storefront.ValidationIntegrationTest
2026-01-15T16:13:02.585+05:30  INFO 31296 --- [storefront-server] [           main] t.c.s.AnnotationConfigContextLoaderUtils : Could not detect default configuration classes for test class [com.storefront.ValidationIntegrationTest]: ValidationIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2026-01-15T16:13:02.586+05:30  INFO 31296 --- [storefront-server] [           main] .b.t.c.SpringBootTestContextBootstrapper : Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.ValidationIntegrationTest

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.1)

2026-01-15T16:13:02.597+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.ValidationIntegrationTest   : Starting ValidationIntegrationTest using Java 25.0.1 with PID 31296 (started by Ahzam Ali in D:\e-workspace\StoreFront-v2\server)
2026-01-15T16:13:02.597+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.ValidationIntegrationTest   : No active profile set, falling back to 1 default profile: "default"
2026-01-15T16:13:02.691+05:30  INFO 31296 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-15T16:13:02.705+05:30  INFO 31296 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 13 ms. Found 11 JPA repository interfaces.
2026-01-15T16:13:02.753+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-9 - Starting...
2026-01-15T16:13:02.754+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-9 - Added connection conn80: url=jdbc:h2:mem:testdb_val user=SA
2026-01-15T16:13:02.755+05:30  INFO 31296 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-9 - Start completed.
2026-01-15T16:13:02.758+05:30  INFO 31296 --- [storefront-server] [           main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:testdb_val (H2 2.2)
2026-01-15T16:13:02.758+05:30  WARN 31296 --- [storefront-server] [           main] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-15T16:13:02.760+05:30  INFO 31296 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-15T16:13:02.760+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbValidate     : Successfully validated 3 migrations (execution time 00:00.001s)
2026-01-15T16:13:02.762+05:30  INFO 31296 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-15T16:13:02.765+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-15T16:13:02.767+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - init schema"
2026-01-15T16:13:02.773+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "4 - add reconciliation log"
2026-01-15T16:13:02.775+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - add product is active"
2026-01-15T16:13:02.779+05:30  INFO 31296 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Successfully applied 3 migrations to schema "PUBLIC", now at version v5 (execution time 00:00.005s)
2026-01-15T16:13:02.787+05:30  INFO 31296 --- [storefront-server] [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-15T16:13:02.789+05:30  INFO 31296 --- [storefront-server] [           main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-15T16:13:02.790+05:30  INFO 31296 --- [storefront-server] [           main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-15T16:13:02.791+05:30  WARN 31296 --- [storefront-server] [           main] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-15T16:13:02.863+05:30  INFO 31296 --- [storefront-server] [           main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
Hibernate: alter table if exists bundle alter column price set data type numeric(38,2)
Hibernate: create table customer (id bigint generated by default as identity, created_at timestamp(6), name varchar(255) not null, phone varchar(255) not null, primary key (id))
Hibernate: alter table if exists customer_order alter column total_amount set data type numeric(38,2)
Hibernate: alter table if exists customer_order add column customer_id bigint
Hibernate: alter table if exists order_line alter column unit_price set data type numeric(38,2)
Hibernate: alter table if exists product alter column base_price set data type numeric(38,2)
Hibernate: alter table if exists reconciliation_log alter column total_revenue set data type numeric(38,2)
Hibernate: alter table if exists customer drop constraint if exists UK_o3uty20c6csmx5y4uk2tc5r4m
Hibernate: alter table if exists customer add constraint UK_o3uty20c6csmx5y4uk2tc5r4m unique (phone)
Hibernate: alter table if exists customer_order add constraint FKf9abd30bhiqvugayxlpq8ryq9 foreign key (customer_id) references customer
2026-01-15T16:13:02.873+05:30  INFO 31296 --- [storefront-server] [           main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-15T16:13:02.875+05:30  WARN 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : JWT signing key initialized (NEW KEY GENERATED - all previous tokens are now invalid)
2026-01-15T16:13:03.033+05:30  WARN 31296 --- [storefront-server] [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-15T16:13:03.040+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.a.w.s.WelcomePageHandlerMapping    : Adding welcome page: class path resource [static/index.html]
2026-01-15T16:13:03.064+05:30  INFO 31296 --- [storefront-server] [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@7556a83e, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@4468f64c, org.springframework.security.web.context.SecurityContextHolderFilter@5c5d7add, org.springframework.security.web.header.HeaderWriterFilter@67c96b50, org.springframework.web.filter.CorsFilter@4e8224cf, org.springframework.security.web.authentication.logout.LogoutFilter@754bd262, com.storefront.security.JwtAuthenticationFilter@79c1233c, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@53418cc0, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@7ffefe13, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@3d1e2b3c, org.springframework.security.web.session.SessionManagementFilter@1bc4ce09, org.springframework.security.web.access.ExceptionTranslationFilter@e602e78, org.springframework.security.web.access.intercept.AuthorizationFilter@5e25a95a]
2026-01-15T16:13:03.108+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:testdb_val'
2026-01-15T16:13:03.119+05:30  INFO 31296 --- [storefront-server] [           main] o.s.b.t.m.w.SpringBootMockServletContext : Initializing Spring TestDispatcherServlet ''
2026-01-15T16:13:03.119+05:30  INFO 31296 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Initializing Servlet ''
2026-01-15T16:13:03.119+05:30  INFO 31296 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Completed initialization in 0 ms
2026-01-15T16:13:03.123+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.ValidationIntegrationTest   : Started ValidationIntegrationTest in 0.535 seconds (process running for 15.522)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: admin_val
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
2026-01-15T16:13:03.271+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:13:03.274+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_val, Role: ADMIN, Authority: ROLE_ADMIN
=== LOGIN DEBUG ===
Attempting login for username: admin_val
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
User found! Stored hash: $2a$10$SzjL6hYYtNR2OMTinzsXaubSDAM411/gdgZQbsvC.X1C5kWgaQ8Ju
Input password: pass
Password matches: true
===================
=== LOGIN DEBUG ===
Attempting login for username: admin_val
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
User found! Stored hash: $2a$10$SzjL6hYYtNR2OMTinzsXaubSDAM411/gdgZQbsvC.X1C5kWgaQ8Ju
Input password: pass
Password matches: true
===================
2026-01-15T16:13:03.419+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:13:03.421+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_val, Role: ADMIN, Authority: ROLE_ADMIN
=== LOGIN DEBUG ===
Attempting login for username: admin_val
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
User found! Stored hash: $2a$10$SzjL6hYYtNR2OMTinzsXaubSDAM411/gdgZQbsvC.X1C5kWgaQ8Ju
Input password: pass
Password matches: true
===================
=== LOGIN DEBUG ===
Attempting login for username: admin_val
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
User found! Stored hash: $2a$10$SzjL6hYYtNR2OMTinzsXaubSDAM411/gdgZQbsvC.X1C5kWgaQ8Ju
Input password: pass
Password matches: true
===================
2026-01-15T16:13:03.562+05:30  INFO 31296 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:13:03.564+05:30  INFO 31296 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_val, Role: ADMIN, Authority: ROLE_ADMIN
[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.982 s -- in com.storefront.ValidationIntegrationTest
[INFO] 
[INFO] Results:
[INFO] 
[ERROR] Failures: 
[ERROR]   InventorySearchIntegrationTest.setUp:118->allocateStock:147 Status expected:<200> but was:<403>
[ERROR]   InventorySearchIntegrationTest.setUp:118->allocateStock:147 Status expected:<200> but was:<403>
[ERROR]   InventorySearchIntegrationTest.setUp:118->allocateStock:147 Status expected:<200> but was:<403>
[ERROR]   StoreIntegrationTest.testAllocationAndReconciliation:115 Status expected:<200> but was:<403>
[ERROR]   StoreIntegrationTest.testStoreAccessBoundary:215 Status expected:<403> but was:<400>
[ERROR] Errors: 
[ERROR]   ConcurrencyIntegrationTest.testConcurrentAllocation:144 Runtime Zero successful allocations - check configuration
[ERROR]   OrderIntegrationTest.setup:104 ╗ AccessDenied User does not have access to this store
[ERROR]   OrderIntegrationTest.setup:104 ╗ AccessDenied User does not have access to this store
[ERROR]   OrderIntegrationTest.setup:104 ╗ AccessDenied User does not have access to this store
[INFO] 
[ERROR] Tests run: 30, Failures: 5, Errors: 4, Skipped: 0
[INFO] 
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  18.167 s
[INFO] Finished at: 2026-01-15T16:13:03+05:30
[INFO] ------------------------------------------------------------------------
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:3.1.2:test (default-test) on project storefront-server: There are test failures.
[ERROR] 
[ERROR] Please refer to D:\e-workspace\StoreFront-v2\server\target\surefire-reports for the individual test results.
[ERROR] Please refer to dump files (if any exist) [date].dump, [date]-jvmRun[N].dump and [date].dumpstream.
[ERROR] -> [Help 1]
[ERROR] 
[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.
[ERROR] Re-run Maven using the -X switch to enable full debug logging.
[ERROR] 
[ERROR] For more information about the errors and possible solutions, please read the following articles:
[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException
