[INFO] Scanning for projects...
[INFO] 
[INFO] ------------------< com.storefront:storefront-server >------------------
[INFO] Building storefront-server 0.0.1-SNAPSHOT
[INFO]   from pom.xml
[INFO] --------------------------------[ jar ]---------------------------------
[INFO] 
[INFO] --- resources:3.3.1:resources (default-resources) @ storefront-server ---
[INFO] Copying 1 resource from src\main\resources to target\classes
[INFO] Copying 7 resources from src\main\resources to target\classes
[INFO] 
[INFO] --- compiler:3.11.0:compile (default-compile) @ storefront-server ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- resources:3.3.1:testResources (default-testResources) @ storefront-server ---
[INFO] Copying 1 resource from src\test\resources to target\test-classes
[INFO] 
[INFO] --- compiler:3.11.0:testCompile (default-testCompile) @ storefront-server ---
[INFO] Nothing to compile - all classes are up to date
[INFO] 
[INFO] --- surefire:3.1.2:test (default-test) @ storefront-server ---
[INFO] Using auto detected provider org.apache.maven.surefire.junitplatform.JUnitPlatformProvider
[INFO] 
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running com.storefront.AuthIntegrationTest
16:09:52.136 [main] INFO org.springframework.test.context.support.AnnotationConfigContextLoaderUtils -- Could not detect default configuration classes for test class [com.storefront.AuthIntegrationTest]: AuthIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
16:09:52.282 [main] INFO org.springframework.boot.test.context.SpringBootTestContextBootstrapper -- Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.AuthIntegrationTest

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.1)

2026-01-15T16:09:52.720+05:30  INFO 31176 --- [storefront-server] [           main] com.storefront.AuthIntegrationTest       : Starting AuthIntegrationTest using Java 25.0.1 with PID 31176 (started by Ahzam Ali in D:\e-workspace\StoreFront-v2\server)
2026-01-15T16:09:52.723+05:30  INFO 31176 --- [storefront-server] [           main] com.storefront.AuthIntegrationTest       : No active profile set, falling back to 1 default profile: "default"
2026-01-15T16:09:53.854+05:30  INFO 31176 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-15T16:09:53.947+05:30  INFO 31176 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 83 ms. Found 11 JPA repository interfaces.
2026-01-15T16:09:54.531+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2026-01-15T16:09:54.768+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection conn0: url=jdbc:h2:mem:testdb_auth user=SA
2026-01-15T16:09:54.770+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2026-01-15T16:09:54.859+05:30  INFO 31176 --- [storefront-server] [           main] o.f.c.internal.license.VersionPrinter    : Flyway Community Edition 9.22.3 by Redgate
2026-01-15T16:09:54.859+05:30  INFO 31176 --- [storefront-server] [           main] o.f.c.internal.license.VersionPrinter    : See release notes here: https://rd.gt/416ObMi
2026-01-15T16:09:54.859+05:30  INFO 31176 --- [storefront-server] [           main] o.f.c.internal.license.VersionPrinter    : 
2026-01-15T16:09:54.911+05:30  INFO 31176 --- [storefront-server] [           main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:testdb_auth (H2 2.2)
2026-01-15T16:09:54.916+05:30  WARN 31176 --- [storefront-server] [           main] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-15T16:09:54.948+05:30  INFO 31176 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-15T16:09:54.953+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbValidate     : Successfully validated 3 migrations (execution time 00:00.022s)
2026-01-15T16:09:54.960+05:30  INFO 31176 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-15T16:09:54.984+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-15T16:09:54.994+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - init schema"
2026-01-15T16:09:55.034+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "4 - add reconciliation log"
2026-01-15T16:09:55.040+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - add product is active"
2026-01-15T16:09:55.055+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Successfully applied 3 migrations to schema "PUBLIC", now at version v5 (execution time 00:00.041s)
2026-01-15T16:09:55.150+05:30  INFO 31176 --- [storefront-server] [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-15T16:09:55.228+05:30  INFO 31176 --- [storefront-server] [           main] org.hibernate.Version                    : HHH000412: Hibernate ORM core version 6.4.1.Final
2026-01-15T16:09:55.278+05:30  INFO 31176 --- [storefront-server] [           main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-15T16:09:55.600+05:30  INFO 31176 --- [storefront-server] [           main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-15T16:09:55.659+05:30  WARN 31176 --- [storefront-server] [           main] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-15T16:09:56.781+05:30  INFO 31176 --- [storefront-server] [           main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
Hibernate: alter table if exists bundle alter column price set data type numeric(38,2)
Hibernate: create table customer (id bigint generated by default as identity, created_at timestamp(6), name varchar(255) not null, phone varchar(255) not null, primary key (id))
Hibernate: alter table if exists customer_order alter column total_amount set data type numeric(38,2)
Hibernate: alter table if exists customer_order add column customer_id bigint
Hibernate: alter table if exists order_line alter column unit_price set data type numeric(38,2)
Hibernate: alter table if exists product alter column base_price set data type numeric(38,2)
Hibernate: alter table if exists reconciliation_log alter column total_revenue set data type numeric(38,2)
Hibernate: alter table if exists customer drop constraint if exists UK_o3uty20c6csmx5y4uk2tc5r4m
Hibernate: alter table if exists customer add constraint UK_o3uty20c6csmx5y4uk2tc5r4m unique (phone)
Hibernate: alter table if exists customer_order add constraint FKf9abd30bhiqvugayxlpq8ryq9 foreign key (customer_id) references customer
2026-01-15T16:09:56.851+05:30  INFO 31176 --- [storefront-server] [           main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-15T16:09:56.880+05:30  WARN 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : JWT signing key initialized (NEW KEY GENERATED - all previous tokens are now invalid)
2026-01-15T16:09:57.547+05:30  WARN 31176 --- [storefront-server] [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-15T16:09:57.647+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.a.w.s.WelcomePageHandlerMapping    : Adding welcome page: class path resource [static/index.html]
2026-01-15T16:09:57.847+05:30  INFO 31176 --- [storefront-server] [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@c7008b4, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@3f54fabc, org.springframework.security.web.context.SecurityContextHolderFilter@369f85c6, org.springframework.security.web.header.HeaderWriterFilter@174e5929, org.springframework.web.filter.CorsFilter@719e8f9f, org.springframework.security.web.authentication.logout.LogoutFilter@48e1e18a, com.storefront.security.JwtAuthenticationFilter@373c8f35, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@5dc218e2, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@11d474a, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@5122387, org.springframework.security.web.session.SessionManagementFilter@5d160056, org.springframework.security.web.access.ExceptionTranslationFilter@5ec921f1, org.springframework.security.web.access.intercept.AuthorizationFilter@14b4f462]
2026-01-15T16:09:58.168+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:testdb_auth'
2026-01-15T16:09:58.217+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.t.m.w.SpringBootMockServletContext : Initializing Spring TestDispatcherServlet ''
2026-01-15T16:09:58.217+05:30  INFO 31176 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Initializing Servlet ''
2026-01-15T16:09:58.217+05:30  INFO 31176 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Completed initialization in 0 ms
2026-01-15T16:09:58.235+05:30  INFO 31176 --- [storefront-server] [           main] com.storefront.AuthIntegrationTest       : Started AuthIntegrationTest in 5.795 seconds (process running for 7.078)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: non_existent
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
=== LOGIN DEBUG ===
Attempting login for username: superadmin
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
User found! Stored hash: $2a$10$JKVlxpw5Ty6l/dtqd0g72eVHE.ixqfl51vhsCSSkzO3CGD6A.SL4K
Input password: password
Password matches: true
===================
2026-01-15T16:09:59.104+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:09:59.109+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: superadmin, Role: SUPER_ADMIN, Authority: ROLE_SUPER_ADMIN
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: admin_del
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
User found! Stored hash: $2a$10$ZYTNPL.SxMGYnDhNJmW3y.hAkU9gwh51dVF60dBt76JEbGupYy6OO
Input password: pass
Password matches: true
===================
2026-01-15T16:09:59.312+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:09:59.316+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_del, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
2026-01-15T16:09:59.384+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:09:59.387+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_del, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:09:59.403+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:09:59.416+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_del, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type,au1_0.username from app_user au1_0 left join user_stores s1_0 on au1_0.id=s1_0.user_id left join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where au1_0.id=?
Hibernate: delete from app_user where id=?
=== LOGIN DEBUG ===
Attempting login for username: superadmin
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
User found! Stored hash: $2a$10$JKVlxpw5Ty6l/dtqd0g72eVHE.ixqfl51vhsCSSkzO3CGD6A.SL4K
Input password: password
Password matches: true
===================
2026-01-15T16:09:59.506+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:09:59.508+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: superadmin, Role: SUPER_ADMIN, Authority: ROLE_SUPER_ADMIN
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: testuser_1768473599504
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
User found! Stored hash: $2a$10$gvu3f1hdDLonUhQ/D2HqceyWzBpNz4ScSqqgjxIss9ytMQKTgBXMe
Input password: password123
Password matches: true
===================
2026-01-15T16:09:59.669+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:09:59.672+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: superadmin, Role: SUPER_ADMIN, Authority: ROLE_SUPER_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 7.707 s -- in com.storefront.AuthIntegrationTest
[INFO] Running com.storefront.ConcurrencyIntegrationTest
2026-01-15T16:09:59.682+05:30  INFO 31176 --- [storefront-server] [           main] t.c.s.AnnotationConfigContextLoaderUtils : Could not detect default configuration classes for test class [com.storefront.ConcurrencyIntegrationTest]: ConcurrencyIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2026-01-15T16:09:59.684+05:30  INFO 31176 --- [storefront-server] [           main] .b.t.c.SpringBootTestContextBootstrapper : Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.ConcurrencyIntegrationTest

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.1)

2026-01-15T16:09:59.705+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.ConcurrencyIntegrationTest  : Starting ConcurrencyIntegrationTest using Java 25.0.1 with PID 31176 (started by Ahzam Ali in D:\e-workspace\StoreFront-v2\server)
2026-01-15T16:09:59.705+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.ConcurrencyIntegrationTest  : No active profile set, falling back to 1 default profile: "default"
2026-01-15T16:09:59.838+05:30  INFO 31176 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-15T16:09:59.854+05:30  INFO 31176 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 15 ms. Found 11 JPA repository interfaces.
2026-01-15T16:09:59.914+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-2 - Starting...
2026-01-15T16:09:59.917+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-2 - Added connection conn10: url=jdbc:h2:mem:testdb_conc user=SA
2026-01-15T16:09:59.917+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-2 - Start completed.
2026-01-15T16:09:59.923+05:30  INFO 31176 --- [storefront-server] [           main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:testdb_conc (H2 2.2)
2026-01-15T16:09:59.924+05:30  WARN 31176 --- [storefront-server] [           main] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-15T16:09:59.928+05:30  INFO 31176 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-15T16:09:59.928+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbValidate     : Successfully validated 3 migrations (execution time 00:00.002s)
2026-01-15T16:09:59.928+05:30  INFO 31176 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-15T16:09:59.934+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-15T16:09:59.938+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - init schema"
2026-01-15T16:09:59.951+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "4 - add reconciliation log"
2026-01-15T16:09:59.956+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - add product is active"
2026-01-15T16:09:59.962+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Successfully applied 3 migrations to schema "PUBLIC", now at version v5 (execution time 00:00.014s)
2026-01-15T16:09:59.976+05:30  INFO 31176 --- [storefront-server] [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-15T16:09:59.978+05:30  INFO 31176 --- [storefront-server] [           main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-15T16:09:59.982+05:30  INFO 31176 --- [storefront-server] [           main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-15T16:09:59.983+05:30  WARN 31176 --- [storefront-server] [           main] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-15T16:10:00.125+05:30  INFO 31176 --- [storefront-server] [           main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
Hibernate: alter table if exists bundle alter column price set data type numeric(38,2)
Hibernate: create table customer (id bigint generated by default as identity, created_at timestamp(6), name varchar(255) not null, phone varchar(255) not null, primary key (id))
Hibernate: alter table if exists customer_order alter column total_amount set data type numeric(38,2)
Hibernate: alter table if exists customer_order add column customer_id bigint
Hibernate: alter table if exists order_line alter column unit_price set data type numeric(38,2)
Hibernate: alter table if exists product alter column base_price set data type numeric(38,2)
Hibernate: alter table if exists reconciliation_log alter column total_revenue set data type numeric(38,2)
Hibernate: alter table if exists customer drop constraint if exists UK_o3uty20c6csmx5y4uk2tc5r4m
Hibernate: alter table if exists customer add constraint UK_o3uty20c6csmx5y4uk2tc5r4m unique (phone)
Hibernate: alter table if exists customer_order add constraint FKf9abd30bhiqvugayxlpq8ryq9 foreign key (customer_id) references customer
2026-01-15T16:10:00.148+05:30  INFO 31176 --- [storefront-server] [           main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-15T16:10:00.151+05:30  WARN 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : JWT signing key initialized (NEW KEY GENERATED - all previous tokens are now invalid)
2026-01-15T16:10:00.312+05:30  WARN 31176 --- [storefront-server] [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-15T16:10:00.320+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.a.w.s.WelcomePageHandlerMapping    : Adding welcome page: class path resource [static/index.html]
2026-01-15T16:10:00.352+05:30  INFO 31176 --- [storefront-server] [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@2b45ede, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@77a38cec, org.springframework.security.web.context.SecurityContextHolderFilter@7de54be7, org.springframework.security.web.header.HeaderWriterFilter@52421f92, org.springframework.web.filter.CorsFilter@51b22f06, org.springframework.security.web.authentication.logout.LogoutFilter@18161415, com.storefront.security.JwtAuthenticationFilter@28089256, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@22b9f45f, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@60c5c115, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@29e94753, org.springframework.security.web.session.SessionManagementFilter@1916d0eb, org.springframework.security.web.access.ExceptionTranslationFilter@f5a1b27, org.springframework.security.web.access.intercept.AuthorizationFilter@2aaa5122]
2026-01-15T16:10:00.396+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:testdb_conc'
2026-01-15T16:10:00.406+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.t.m.w.SpringBootMockServletContext : Initializing Spring TestDispatcherServlet ''
2026-01-15T16:10:00.406+05:30  INFO 31176 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Initializing Servlet ''
2026-01-15T16:10:00.406+05:30  INFO 31176 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Completed initialization in 0 ms
2026-01-15T16:10:00.410+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.ConcurrencyIntegrationTest  : Started ConcurrencyIntegrationTest in 0.723 seconds (process running for 9.254)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
=== LOGIN DEBUG ===
Attempting login for username: admin_conc
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
2026-01-15T16:10:00.604+05:30  INFO 31176 --- [storefront-server] [pool-3-thread-7] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
2026-01-15T16:10:00.604+05:30  INFO 31176 --- [storefront-server] [ool-3-thread-10] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
2026-01-15T16:10:00.604+05:30  INFO 31176 --- [storefront-server] [pool-3-thread-9] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
2026-01-15T16:10:00.604+05:30  INFO 31176 --- [storefront-server] [pool-3-thread-4] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
2026-01-15T16:10:00.605+05:30  INFO 31176 --- [storefront-server] [pool-3-thread-5] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
2026-01-15T16:10:00.604+05:30  INFO 31176 --- [storefront-server] [pool-3-thread-2] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
2026-01-15T16:10:00.604+05:30  INFO 31176 --- [storefront-server] [pool-3-thread-8] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
2026-01-15T16:10:00.604+05:30  INFO 31176 --- [storefront-server] [pool-3-thread-6] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
2026-01-15T16:10:00.604+05:30  INFO 31176 --- [storefront-server] [pool-3-thread-3] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
2026-01-15T16:10:00.605+05:30  INFO 31176 --- [storefront-server] [pool-3-thread-1] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:10:00.610+05:30  INFO 31176 --- [storefront-server] [pool-3-thread-8] c.s.security.CustomUserDetailsService    : User found: admin_conc, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:10:00.610+05:30  INFO 31176 --- [storefront-server] [pool-3-thread-6] c.s.security.CustomUserDetailsService    : User found: admin_conc, Role: ADMIN, Authority: ROLE_ADMIN
2026-01-15T16:10:00.610+05:30  INFO 31176 --- [storefront-server] [pool-3-thread-4] c.s.security.CustomUserDetailsService    : User found: admin_conc, Role: ADMIN, Authority: ROLE_ADMIN
2026-01-15T16:10:00.610+05:30  INFO 31176 --- [storefront-server] [pool-3-thread-7] c.s.security.CustomUserDetailsService    : User found: admin_conc, Role: ADMIN, Authority: ROLE_ADMIN
2026-01-15T16:10:00.610+05:30  INFO 31176 --- [storefront-server] [pool-3-thread-3] c.s.security.CustomUserDetailsService    : User found: admin_conc, Role: ADMIN, Authority: ROLE_ADMIN
2026-01-15T16:10:00.610+05:30  INFO 31176 --- [storefront-server] [pool-3-thread-9] c.s.security.CustomUserDetailsService    : User found: admin_conc, Role: ADMIN, Authority: ROLE_ADMIN
2026-01-15T16:10:00.610+05:30  INFO 31176 --- [storefront-server] [ool-3-thread-10] c.s.security.CustomUserDetailsService    : User found: admin_conc, Role: ADMIN, Authority: ROLE_ADMIN
2026-01-15T16:10:00.611+05:30  INFO 31176 --- [storefront-server] [pool-3-thread-2] c.s.security.CustomUserDetailsService    : User found: admin_conc, Role: ADMIN, Authority: ROLE_ADMIN
2026-01-15T16:10:00.611+05:30  INFO 31176 --- [storefront-server] [pool-3-thread-5] c.s.security.CustomUserDetailsService    : User found: admin_conc, Role: ADMIN, Authority: ROLE_ADMIN
2026-01-15T16:10:00.611+05:30  INFO 31176 --- [storefront-server] [pool-3-thread-1] c.s.security.CustomUserDetailsService    : User found: admin_conc, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from store s1_0 left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where s1_0.id=?
Hibernate: select s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from store s1_0 left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where s1_0.id=?
Hibernate: select s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from store s1_0 left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where s1_0.id=?
Hibernate: select s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from store s1_0 left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where s1_0.id=?
Hibernate: select s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from store s1_0 left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where s1_0.id=?
Hibernate: select s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from store s1_0 left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where s1_0.id=?
Hibernate: select s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from store s1_0 left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where s1_0.id=?
Hibernate: select s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from store s1_0 left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where s1_0.id=?
Hibernate: select s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from store s1_0 left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where s1_0.id=?
Hibernate: select s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from store s1_0 left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where s1_0.id=?
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 1.093 s <<< FAILURE! -- in com.storefront.ConcurrencyIntegrationTest
[ERROR] com.storefront.ConcurrencyIntegrationTest.testConcurrentAllocation -- Time elapsed: 0.284 s <<< ERROR!
org.springframework.dao.InvalidDataAccessApiUsageException: Query requires transaction be in progress, but no transaction is known to be in progress
	at org.springframework.orm.jpa.EntityManagerFactoryUtils.convertJpaAccessExceptionIfPossible(EntityManagerFactoryUtils.java:400)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.translateExceptionIfPossible(HibernateJpaDialect.java:246)
	at org.springframework.orm.jpa.AbstractEntityManagerFactoryBean.translateExceptionIfPossible(AbstractEntityManagerFactoryBean.java:550)
	at org.springframework.dao.support.ChainedPersistenceExceptionTranslator.translateExceptionIfPossible(ChainedPersistenceExceptionTranslator.java:61)
	at org.springframework.dao.support.DataAccessUtils.translateIfNecessary(DataAccessUtils.java:335)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:152)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.jpa.repository.support.CrudMethodMetadataPostProcessor$CrudMethodMetadataPopulatingMethodInterceptor.invoke(CrudMethodMetadataPostProcessor.java:135)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:97)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:249)
	at jdk.proxy2/jdk.proxy2.$Proxy163.findByStoreIdAndProductId(Unknown Source)
	at com.storefront.ConcurrencyIntegrationTest.testConcurrentAllocation(ConcurrencyIntegrationTest.java:120)
	at java.base/java.lang.reflect.Method.invoke(Method.java:565)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)
Caused by: jakarta.persistence.TransactionRequiredException: Query requires transaction be in progress, but no transaction is known to be in progress
	at org.hibernate.internal.AbstractSharedSessionContract.prepareForQueryExecution(AbstractSharedSessionContract.java:464)
	at org.hibernate.query.spi.AbstractSelectionQuery.beforeQuery(AbstractSelectionQuery.java:460)
	at org.hibernate.query.spi.AbstractSelectionQuery.beforeQueryHandlingFetchProfiles(AbstractSelectionQuery.java:446)
	at org.hibernate.query.spi.AbstractSelectionQuery.list(AbstractSelectionQuery.java:424)
	at org.hibernate.query.spi.AbstractSelectionQuery.getSingleResult(AbstractSelectionQuery.java:564)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
	at java.base/java.lang.reflect.Method.invoke(Method.java:565)
	at org.springframework.orm.jpa.SharedEntityManagerCreator$DeferredQueryInvocationHandler.invoke(SharedEntityManagerCreator.java:415)
	at jdk.proxy2/jdk.proxy2.$Proxy179.getSingleResult(Unknown Source)
	at org.springframework.data.jpa.repository.query.JpaQueryExecution$SingleEntityExecution.doExecute(JpaQueryExecution.java:223)
	at org.springframework.data.jpa.repository.query.JpaQueryExecution.execute(JpaQueryExecution.java:92)
	at org.springframework.data.jpa.repository.query.AbstractJpaQuery.doExecute(AbstractJpaQuery.java:149)
	at org.springframework.data.jpa.repository.query.AbstractJpaQuery.execute(AbstractJpaQuery.java:137)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.doInvoke(RepositoryMethodInvoker.java:170)
	at org.springframework.data.repository.core.support.RepositoryMethodInvoker.invoke(RepositoryMethodInvoker.java:158)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.doInvoke(QueryExecutorMethodInterceptor.java:164)
	at org.springframework.data.repository.core.support.QueryExecutorMethodInterceptor.invoke(QueryExecutorMethodInterceptor.java:143)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.data.projection.DefaultMethodInvokingMethodInterceptor.invoke(DefaultMethodInvokingMethodInterceptor.java:70)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:137)
	... 11 more

[INFO] Running com.storefront.config.DataInitializerTest
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.306 s -- in com.storefront.config.DataInitializerTest
[INFO] Running com.storefront.CoreEntityIntegrationTest
2026-01-15T16:10:01.083+05:30  INFO 31176 --- [storefront-server] [           main] t.c.s.AnnotationConfigContextLoaderUtils : Could not detect default configuration classes for test class [com.storefront.CoreEntityIntegrationTest]: CoreEntityIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2026-01-15T16:10:01.085+05:30  INFO 31176 --- [storefront-server] [           main] .b.t.c.SpringBootTestContextBootstrapper : Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.CoreEntityIntegrationTest

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.1)

2026-01-15T16:10:01.101+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.CoreEntityIntegrationTest   : Starting CoreEntityIntegrationTest using Java 25.0.1 with PID 31176 (started by Ahzam Ali in D:\e-workspace\StoreFront-v2\server)
2026-01-15T16:10:01.101+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.CoreEntityIntegrationTest   : No active profile set, falling back to 1 default profile: "default"
2026-01-15T16:10:01.225+05:30  INFO 31176 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-15T16:10:01.240+05:30  INFO 31176 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 14 ms. Found 11 JPA repository interfaces.
2026-01-15T16:10:01.291+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-3 - Starting...
2026-01-15T16:10:01.363+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-3 - Added connection conn20: url=jdbc:h2:file:./data/storefront user=SA
2026-01-15T16:10:01.363+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-3 - Start completed.
2026-01-15T16:10:01.368+05:30  INFO 31176 --- [storefront-server] [           main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:file:./data/storefront (H2 2.2)
2026-01-15T16:10:01.370+05:30  WARN 31176 --- [storefront-server] [           main] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-15T16:10:01.373+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbValidate     : Successfully validated 3 migrations (execution time 00:00.003s)
2026-01-15T16:10:01.377+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": 5
2026-01-15T16:10:01.377+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Schema "PUBLIC" is up to date. No migration necessary.
2026-01-15T16:10:01.388+05:30  INFO 31176 --- [storefront-server] [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-15T16:10:01.389+05:30  INFO 31176 --- [storefront-server] [           main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-15T16:10:01.392+05:30  INFO 31176 --- [storefront-server] [           main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-15T16:10:01.393+05:30  WARN 31176 --- [storefront-server] [           main] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-15T16:10:01.504+05:30  INFO 31176 --- [storefront-server] [           main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
2026-01-15T16:10:01.509+05:30  INFO 31176 --- [storefront-server] [           main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-15T16:10:01.512+05:30  WARN 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : JWT signing key initialized (NEW KEY GENERATED - all previous tokens are now invalid)
2026-01-15T16:10:01.671+05:30  WARN 31176 --- [storefront-server] [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-15T16:10:01.682+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.a.w.s.WelcomePageHandlerMapping    : Adding welcome page: class path resource [static/index.html]
2026-01-15T16:10:01.714+05:30  INFO 31176 --- [storefront-server] [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@fca4863, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@43aa26a9, org.springframework.security.web.context.SecurityContextHolderFilter@654fdde2, org.springframework.security.web.header.HeaderWriterFilter@78e469ac, org.springframework.web.filter.CorsFilter@1d26e653, org.springframework.security.web.authentication.logout.LogoutFilter@1140585, com.storefront.security.JwtAuthenticationFilter@a184485, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@6f279a75, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@34552734, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@2981a626, org.springframework.security.web.session.SessionManagementFilter@1d66664f, org.springframework.security.web.access.ExceptionTranslationFilter@5a6a0107, org.springframework.security.web.access.intercept.AuthorizationFilter@2ed34811]
2026-01-15T16:10:01.770+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:file:./data/storefront'
2026-01-15T16:10:01.784+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.CoreEntityIntegrationTest   : Started CoreEntityIntegrationTest in 0.696 seconds (process running for 10.627)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: insert into bundle (active,description,name,price,sku,id) values (?,?,?,?,?,default)
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,bi1_0.quantity from bundle_item bi1_0 join bundle b1_0 on b1_0.id=bi1_0.bundle_id join product p1_0 on p1_0.id=bi1_0.product_id where (bi1_0.bundle_id,bi1_0.product_id) in ((?,?))
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into bundle_item (quantity,bundle_id,product_id) values (?,?,?)
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: insert into customer_order (created_at,customer_id,discount,user_id,reconciled,status,store_id,total_amount,id) values (?,?,?,?,?,?,?,?,default)
Hibernate: insert into order_line (bundle_id,is_exclusion,order_id,product_id,quantity,unit_price,id) values (?,?,?,?,?,?,default)
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.750 s -- in com.storefront.CoreEntityIntegrationTest
[INFO] Running com.storefront.InventoryIntegrationTest
2026-01-15T16:10:01.834+05:30  INFO 31176 --- [storefront-server] [           main] t.c.s.AnnotationConfigContextLoaderUtils : Could not detect default configuration classes for test class [com.storefront.InventoryIntegrationTest]: InventoryIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2026-01-15T16:10:01.836+05:30  INFO 31176 --- [storefront-server] [           main] .b.t.c.SpringBootTestContextBootstrapper : Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.InventoryIntegrationTest

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.1)

2026-01-15T16:10:01.860+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.InventoryIntegrationTest    : Starting InventoryIntegrationTest using Java 25.0.1 with PID 31176 (started by Ahzam Ali in D:\e-workspace\StoreFront-v2\server)
2026-01-15T16:10:01.860+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.InventoryIntegrationTest    : No active profile set, falling back to 1 default profile: "default"
2026-01-15T16:10:02.017+05:30  INFO 31176 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-15T16:10:02.031+05:30  INFO 31176 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 14 ms. Found 11 JPA repository interfaces.
2026-01-15T16:10:02.081+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-4 - Starting...
2026-01-15T16:10:02.084+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-4 - Added connection conn30: url=jdbc:h2:mem:testdb_inv user=SA
2026-01-15T16:10:02.084+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-4 - Start completed.
2026-01-15T16:10:02.089+05:30  INFO 31176 --- [storefront-server] [           main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:testdb_inv (H2 2.2)
2026-01-15T16:10:02.090+05:30  WARN 31176 --- [storefront-server] [           main] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-15T16:10:02.092+05:30  INFO 31176 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-15T16:10:02.093+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbValidate     : Successfully validated 3 migrations (execution time 00:00.001s)
2026-01-15T16:10:02.093+05:30  INFO 31176 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-15T16:10:02.097+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-15T16:10:02.100+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - init schema"
2026-01-15T16:10:02.107+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "4 - add reconciliation log"
2026-01-15T16:10:02.112+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - add product is active"
2026-01-15T16:10:02.116+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Successfully applied 3 migrations to schema "PUBLIC", now at version v5 (execution time 00:00.008s)
2026-01-15T16:10:02.126+05:30  INFO 31176 --- [storefront-server] [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-15T16:10:02.128+05:30  INFO 31176 --- [storefront-server] [           main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-15T16:10:02.131+05:30  INFO 31176 --- [storefront-server] [           main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-15T16:10:02.131+05:30  WARN 31176 --- [storefront-server] [           main] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-15T16:10:02.235+05:30  INFO 31176 --- [storefront-server] [           main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
Hibernate: alter table if exists bundle alter column price set data type numeric(38,2)
Hibernate: create table customer (id bigint generated by default as identity, created_at timestamp(6), name varchar(255) not null, phone varchar(255) not null, primary key (id))
Hibernate: alter table if exists customer_order alter column total_amount set data type numeric(38,2)
Hibernate: alter table if exists customer_order add column customer_id bigint
Hibernate: alter table if exists order_line alter column unit_price set data type numeric(38,2)
Hibernate: alter table if exists product alter column base_price set data type numeric(38,2)
Hibernate: alter table if exists reconciliation_log alter column total_revenue set data type numeric(38,2)
Hibernate: alter table if exists customer drop constraint if exists UK_o3uty20c6csmx5y4uk2tc5r4m
Hibernate: alter table if exists customer add constraint UK_o3uty20c6csmx5y4uk2tc5r4m unique (phone)
Hibernate: alter table if exists customer_order add constraint FKf9abd30bhiqvugayxlpq8ryq9 foreign key (customer_id) references customer
2026-01-15T16:10:02.259+05:30  INFO 31176 --- [storefront-server] [           main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-15T16:10:02.260+05:30  WARN 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : JWT signing key initialized (NEW KEY GENERATED - all previous tokens are now invalid)
2026-01-15T16:10:02.393+05:30  WARN 31176 --- [storefront-server] [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-15T16:10:02.401+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.a.w.s.WelcomePageHandlerMapping    : Adding welcome page: class path resource [static/index.html]
2026-01-15T16:10:02.431+05:30  INFO 31176 --- [storefront-server] [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@4eb870be, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@227a79e5, org.springframework.security.web.context.SecurityContextHolderFilter@4c27fe7a, org.springframework.security.web.header.HeaderWriterFilter@736f4c27, org.springframework.web.filter.CorsFilter@33d89052, org.springframework.security.web.authentication.logout.LogoutFilter@30dd9615, com.storefront.security.JwtAuthenticationFilter@28494fd9, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@782fb591, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@7128d0c7, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@680410ec, org.springframework.security.web.session.SessionManagementFilter@31b07a16, org.springframework.security.web.access.ExceptionTranslationFilter@570c6601, org.springframework.security.web.access.intercept.AuthorizationFilter@128921c4]
2026-01-15T16:10:02.474+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:testdb_inv'
2026-01-15T16:10:02.483+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.t.m.w.SpringBootMockServletContext : Initializing Spring TestDispatcherServlet ''
2026-01-15T16:10:02.483+05:30  INFO 31176 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Initializing Servlet ''
2026-01-15T16:10:02.483+05:30  INFO 31176 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Completed initialization in 0 ms
2026-01-15T16:10:02.487+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.InventoryIntegrationTest    : Started InventoryIntegrationTest in 0.647 seconds (process running for 11.33)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
2026-01-15T16:10:02.701+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:02.702+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_inv, Role: ADMIN, Authority: ROLE_ADMIN
2026-01-15T16:10:02.707+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:02.711+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: emp_inv, Role: EMPLOYEE, Authority: ROLE_EMPLOYEE
Hibernate: update product set attributes=?,base_price=?,is_active=?,name=?,sku=?,type=? where id=?
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.is_active
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
2026-01-15T16:10:02.882+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:02.889+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_inv, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
2026-01-15T16:10:02.919+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:02.925+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: emp_inv, Role: EMPLOYEE, Authority: ROLE_EMPLOYEE
2026-01-15T16:10:02.931+05:30 ERROR 31176 --- [storefront-server] [           main] com.storefront.config.SecurityConfig     : Access DENIED for POST /api/v1/inventory/products - User: UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=emp_inv, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_EMPLOYEE]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=127.0.0.1, SessionId=null], Granted Authorities=[ROLE_EMPLOYEE]], Error: Access Denied
2026-01-15T16:10:02.935+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:02.939+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_inv, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: insert into bundle (active,description,name,price,sku,id) values (?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,bi1_0.quantity from bundle_item bi1_0 join bundle b1_0 on b1_0.id=bi1_0.bundle_id join product p1_0 on p1_0.id=bi1_0.product_id where (bi1_0.bundle_id,bi1_0.product_id) in ((?,?))
2026-01-15T16:10:02.954+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:02.957+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_inv, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
2026-01-15T16:10:02.971+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:02.974+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_inv, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku from bundle b1_0
Hibernate: insert into bundle_item (quantity,bundle_id,product_id) values (?,?,?)
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,bi1_0.quantity from bundle_item bi1_0 left join bundle b1_0 on b1_0.id=bi1_0.bundle_id where b1_0.id=?
[INFO] Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.156 s -- in com.storefront.InventoryIntegrationTest
[INFO] Running com.storefront.InventorySearchIntegrationTest
2026-01-15T16:10:02.990+05:30  INFO 31176 --- [storefront-server] [           main] t.c.s.AnnotationConfigContextLoaderUtils : Could not detect default configuration classes for test class [com.storefront.InventorySearchIntegrationTest]: InventorySearchIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2026-01-15T16:10:02.993+05:30  INFO 31176 --- [storefront-server] [           main] .b.t.c.SpringBootTestContextBootstrapper : Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.InventorySearchIntegrationTest

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.1)

2026-01-15T16:10:03.009+05:30  INFO 31176 --- [storefront-server] [           main] c.s.InventorySearchIntegrationTest       : Starting InventorySearchIntegrationTest using Java 25.0.1 with PID 31176 (started by Ahzam Ali in D:\e-workspace\StoreFront-v2\server)
2026-01-15T16:10:03.009+05:30  INFO 31176 --- [storefront-server] [           main] c.s.InventorySearchIntegrationTest       : No active profile set, falling back to 1 default profile: "default"
2026-01-15T16:10:03.114+05:30  INFO 31176 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-15T16:10:03.128+05:30  INFO 31176 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 13 ms. Found 11 JPA repository interfaces.
2026-01-15T16:10:03.173+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-5 - Starting...
2026-01-15T16:10:03.175+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-5 - Added connection conn40: url=jdbc:h2:mem:testdb user=SA
2026-01-15T16:10:03.175+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-5 - Start completed.
2026-01-15T16:10:03.179+05:30  INFO 31176 --- [storefront-server] [           main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:testdb (H2 2.2)
2026-01-15T16:10:03.179+05:30  WARN 31176 --- [storefront-server] [           main] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-15T16:10:03.181+05:30  INFO 31176 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-15T16:10:03.182+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbValidate     : Successfully validated 3 migrations (execution time 00:00.001s)
2026-01-15T16:10:03.183+05:30  INFO 31176 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-15T16:10:03.185+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-15T16:10:03.189+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - init schema"
2026-01-15T16:10:03.197+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "4 - add reconciliation log"
2026-01-15T16:10:03.200+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - add product is active"
2026-01-15T16:10:03.204+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Successfully applied 3 migrations to schema "PUBLIC", now at version v5 (execution time 00:00.008s)
2026-01-15T16:10:03.214+05:30  INFO 31176 --- [storefront-server] [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-15T16:10:03.216+05:30  INFO 31176 --- [storefront-server] [           main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-15T16:10:03.218+05:30  INFO 31176 --- [storefront-server] [           main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-15T16:10:03.220+05:30  WARN 31176 --- [storefront-server] [           main] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-15T16:10:03.309+05:30  INFO 31176 --- [storefront-server] [           main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
Hibernate: alter table if exists bundle alter column price set data type numeric(38,2)
Hibernate: create table customer (id bigint generated by default as identity, created_at timestamp(6), name varchar(255) not null, phone varchar(255) not null, primary key (id))
Hibernate: alter table if exists customer_order alter column total_amount set data type numeric(38,2)
Hibernate: alter table if exists customer_order add column customer_id bigint
Hibernate: alter table if exists order_line alter column unit_price set data type numeric(38,2)
Hibernate: alter table if exists product alter column base_price set data type numeric(38,2)
Hibernate: alter table if exists reconciliation_log alter column total_revenue set data type numeric(38,2)
Hibernate: alter table if exists customer drop constraint if exists UK_o3uty20c6csmx5y4uk2tc5r4m
Hibernate: alter table if exists customer add constraint UK_o3uty20c6csmx5y4uk2tc5r4m unique (phone)
Hibernate: alter table if exists customer_order add constraint FKf9abd30bhiqvugayxlpq8ryq9 foreign key (customer_id) references customer
2026-01-15T16:10:03.324+05:30  INFO 31176 --- [storefront-server] [           main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-15T16:10:03.325+05:30  WARN 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : JWT signing key initialized (NEW KEY GENERATED - all previous tokens are now invalid)
2026-01-15T16:10:03.443+05:30  WARN 31176 --- [storefront-server] [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-15T16:10:03.451+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.a.w.s.WelcomePageHandlerMapping    : Adding welcome page: class path resource [static/index.html]
2026-01-15T16:10:03.482+05:30  INFO 31176 --- [storefront-server] [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@39ed2eb1, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@485f34dc, org.springframework.security.web.context.SecurityContextHolderFilter@885ac1a, org.springframework.security.web.header.HeaderWriterFilter@708c1263, org.springframework.web.filter.CorsFilter@4593aeea, org.springframework.security.web.authentication.logout.LogoutFilter@703be135, com.storefront.security.JwtAuthenticationFilter@5f93c6ef, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@65dfb9ed, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@7550b03f, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@51cfa104, org.springframework.security.web.session.SessionManagementFilter@35b2a73e, org.springframework.security.web.access.ExceptionTranslationFilter@21a993d4, org.springframework.security.web.access.intercept.AuthorizationFilter@16704703]
2026-01-15T16:10:03.524+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:testdb'
2026-01-15T16:10:03.532+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.t.m.w.SpringBootMockServletContext : Initializing Spring TestDispatcherServlet ''
2026-01-15T16:10:03.532+05:30  INFO 31176 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Initializing Servlet ''
2026-01-15T16:10:03.533+05:30  INFO 31176 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Completed initialization in 1 ms
2026-01-15T16:10:03.539+05:30  INFO 31176 --- [storefront-server] [           main] c.s.InventorySearchIntegrationTest       : Started InventorySearchIntegrationTest in 0.543 seconds (process running for 12.382)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
2026-01-15T16:10:03.689+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:03.691+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: inv_search_admin, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
2026-01-15T16:10:03.731+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:03.733+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: inv_search_admin, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
2026-01-15T16:10:03.757+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:03.760+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: inv_search_admin, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
2026-01-15T16:10:03.775+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:03.778+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: inv_search_admin, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
2026-01-15T16:10:03.793+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:03.795+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: inv_search_admin, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id where sl1_0.store_id=? and (lower(p1_0.name) like ? escape '' or lower(cast(p1_0.attributes as varchar)) like ? escape '')
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
2026-01-15T16:10:03.904+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:03.906+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: inv_search_admin, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
2026-01-15T16:10:03.928+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:03.930+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: inv_search_admin, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
2026-01-15T16:10:03.943+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:03.946+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: inv_search_admin, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
2026-01-15T16:10:03.956+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:03.959+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: inv_search_admin, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
2026-01-15T16:10:03.968+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:03.970+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: inv_search_admin, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id where sl1_0.store_id=? and (lower(p1_0.name) like ? escape '' or lower(cast(p1_0.attributes as varchar)) like ? escape '')
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
2026-01-15T16:10:04.047+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:04.048+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: inv_search_admin, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
2026-01-15T16:10:04.068+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:04.070+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: inv_search_admin, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
2026-01-15T16:10:04.084+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:04.087+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: inv_search_admin, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
2026-01-15T16:10:04.101+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:04.103+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: inv_search_admin, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
2026-01-15T16:10:04.116+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:04.117+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: inv_search_admin, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id where sl1_0.store_id=? and (lower(p1_0.name) like ? escape '' or lower(cast(p1_0.attributes as varchar)) like ? escape '')
[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.134 s -- in com.storefront.InventorySearchIntegrationTest
[INFO] Running com.storefront.OrderIntegrationTest
2026-01-15T16:10:04.125+05:30  INFO 31176 --- [storefront-server] [           main] t.c.s.AnnotationConfigContextLoaderUtils : Could not detect default configuration classes for test class [com.storefront.OrderIntegrationTest]: OrderIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2026-01-15T16:10:04.127+05:30  INFO 31176 --- [storefront-server] [           main] .b.t.c.SpringBootTestContextBootstrapper : Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.OrderIntegrationTest

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.1)

2026-01-15T16:10:04.139+05:30  INFO 31176 --- [storefront-server] [           main] com.storefront.OrderIntegrationTest      : Starting OrderIntegrationTest using Java 25.0.1 with PID 31176 (started by Ahzam Ali in D:\e-workspace\StoreFront-v2\server)
2026-01-15T16:10:04.139+05:30  INFO 31176 --- [storefront-server] [           main] com.storefront.OrderIntegrationTest      : No active profile set, falling back to 1 default profile: "default"
2026-01-15T16:10:04.247+05:30  INFO 31176 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-15T16:10:04.260+05:30  INFO 31176 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 13 ms. Found 11 JPA repository interfaces.
2026-01-15T16:10:04.317+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-6 - Starting...
2026-01-15T16:10:04.321+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-6 - Added connection conn50: url=jdbc:h2:mem:testdb_order user=SA
2026-01-15T16:10:04.321+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-6 - Start completed.
2026-01-15T16:10:04.329+05:30  INFO 31176 --- [storefront-server] [           main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:testdb_order (H2 2.2)
2026-01-15T16:10:04.330+05:30  WARN 31176 --- [storefront-server] [           main] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-15T16:10:04.332+05:30  INFO 31176 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-15T16:10:04.333+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbValidate     : Successfully validated 3 migrations (execution time 00:00.002s)
2026-01-15T16:10:04.334+05:30  INFO 31176 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-15T16:10:04.337+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-15T16:10:04.341+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - init schema"
2026-01-15T16:10:04.348+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "4 - add reconciliation log"
2026-01-15T16:10:04.352+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - add product is active"
2026-01-15T16:10:04.360+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Successfully applied 3 migrations to schema "PUBLIC", now at version v5 (execution time 00:00.007s)
2026-01-15T16:10:04.372+05:30  INFO 31176 --- [storefront-server] [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-15T16:10:04.374+05:30  INFO 31176 --- [storefront-server] [           main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-15T16:10:04.377+05:30  INFO 31176 --- [storefront-server] [           main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-15T16:10:04.378+05:30  WARN 31176 --- [storefront-server] [           main] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-15T16:10:04.461+05:30  INFO 31176 --- [storefront-server] [           main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
Hibernate: alter table if exists bundle alter column price set data type numeric(38,2)
Hibernate: create table customer (id bigint generated by default as identity, created_at timestamp(6), name varchar(255) not null, phone varchar(255) not null, primary key (id))
Hibernate: alter table if exists customer_order alter column total_amount set data type numeric(38,2)
Hibernate: alter table if exists customer_order add column customer_id bigint
Hibernate: alter table if exists order_line alter column unit_price set data type numeric(38,2)
Hibernate: alter table if exists product alter column base_price set data type numeric(38,2)
Hibernate: alter table if exists reconciliation_log alter column total_revenue set data type numeric(38,2)
Hibernate: alter table if exists customer drop constraint if exists UK_o3uty20c6csmx5y4uk2tc5r4m
Hibernate: alter table if exists customer add constraint UK_o3uty20c6csmx5y4uk2tc5r4m unique (phone)
Hibernate: alter table if exists customer_order add constraint FKf9abd30bhiqvugayxlpq8ryq9 foreign key (customer_id) references customer
2026-01-15T16:10:04.473+05:30  INFO 31176 --- [storefront-server] [           main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-15T16:10:04.476+05:30  WARN 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : JWT signing key initialized (NEW KEY GENERATED - all previous tokens are now invalid)
2026-01-15T16:10:04.604+05:30  WARN 31176 --- [storefront-server] [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-15T16:10:04.612+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.a.w.s.WelcomePageHandlerMapping    : Adding welcome page: class path resource [static/index.html]
2026-01-15T16:10:04.634+05:30  INFO 31176 --- [storefront-server] [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@57c13d0e, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@4c8bbc6d, org.springframework.security.web.context.SecurityContextHolderFilter@15f0d6c7, org.springframework.security.web.header.HeaderWriterFilter@30cdb46, org.springframework.web.filter.CorsFilter@4a30fa8f, org.springframework.security.web.authentication.logout.LogoutFilter@1570db98, com.storefront.security.JwtAuthenticationFilter@6d692034, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@3f05744b, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@5a365e06, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@7aee9f49, org.springframework.security.web.session.SessionManagementFilter@508189cc, org.springframework.security.web.access.ExceptionTranslationFilter@26e197cd, org.springframework.security.web.access.intercept.AuthorizationFilter@447e9202]
2026-01-15T16:10:04.693+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:testdb_order'
2026-01-15T16:10:04.701+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.t.m.w.SpringBootMockServletContext : Initializing Spring TestDispatcherServlet ''
2026-01-15T16:10:04.701+05:30  INFO 31176 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Initializing Servlet ''
2026-01-15T16:10:04.701+05:30  INFO 31176 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Completed initialization in 0 ms
2026-01-15T16:10:04.707+05:30  INFO 31176 --- [storefront-server] [           main] com.storefront.OrderIntegrationTest      : Started OrderIntegrationTest in 0.578 seconds (process running for 13.55)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into bundle (active,description,name,price,sku,id) values (?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,bi1_0.quantity from bundle_item bi1_0 join bundle b1_0 on b1_0.id=bi1_0.bundle_id join product p1_0 on p1_0.id=bi1_0.product_id where (bi1_0.bundle_id,bi1_0.product_id) in ((?,?))
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,bi1_0.quantity from bundle_item bi1_0 join bundle b1_0 on b1_0.id=bi1_0.bundle_id join product p1_0 on p1_0.id=bi1_0.product_id where (bi1_0.bundle_id,bi1_0.product_id) in ((?,?))
Hibernate: insert into bundle_item (quantity,bundle_id,product_id) values (?,?,?)
Hibernate: insert into bundle_item (quantity,bundle_id,product_id) values (?,?,?)
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
2026-01-15T16:10:04.915+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:04.919+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: employee, Role: EMPLOYEE, Authority: ROLE_EMPLOYEE
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from store s1_0 left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where s1_0.id=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into bundle (active,description,name,price,sku,id) values (?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,bi1_0.quantity from bundle_item bi1_0 join bundle b1_0 on b1_0.id=bi1_0.bundle_id join product p1_0 on p1_0.id=bi1_0.product_id where (bi1_0.bundle_id,bi1_0.product_id) in ((?,?))
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,bi1_0.quantity from bundle_item bi1_0 join bundle b1_0 on b1_0.id=bi1_0.bundle_id join product p1_0 on p1_0.id=bi1_0.product_id where (bi1_0.bundle_id,bi1_0.product_id) in ((?,?))
Hibernate: insert into bundle_item (quantity,bundle_id,product_id) values (?,?,?)
Hibernate: insert into bundle_item (quantity,bundle_id,product_id) values (?,?,?)
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
2026-01-15T16:10:05.047+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:05.050+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: employee, Role: EMPLOYEE, Authority: ROLE_EMPLOYEE
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into customer_order (created_at,customer_id,discount,user_id,reconciled,status,store_id,total_amount,id) values (?,?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: insert into order_line (bundle_id,is_exclusion,order_id,product_id,quantity,unit_price,id) values (?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.is_active
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: update customer_order set customer_id=?,discount=?,user_id=?,reconciled=?,status=?,store_id=?,total_amount=? where id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
2026-01-15T16:10:05.073+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:05.075+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: employee, Role: EMPLOYEE, Authority: ROLE_EMPLOYEE
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into customer_order (created_at,customer_id,discount,user_id,reconciled,status,store_id,total_amount,id) values (?,?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku from bundle b1_0 where b1_0.sku=?
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,bi1_0.quantity from bundle_item bi1_0 left join bundle b1_0 on b1_0.id=bi1_0.bundle_id where b1_0.id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: insert into order_line (bundle_id,is_exclusion,order_id,product_id,quantity,unit_price,id) values (?,?,?,?,?,?,default)
Hibernate: insert into order_line (bundle_id,is_exclusion,order_id,product_id,quantity,unit_price,id) values (?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.is_active
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: update customer_order set customer_id=?,discount=?,user_id=?,reconciled=?,status=?,store_id=?,total_amount=? where id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
2026-01-15T16:10:05.097+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:05.103+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: employee, Role: EMPLOYEE, Authority: ROLE_EMPLOYEE
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into customer_order (created_at,customer_id,discount,user_id,reconciled,status,store_id,total_amount,id) values (?,?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku from bundle b1_0 where b1_0.sku=?
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,bi1_0.quantity from bundle_item bi1_0 left join bundle b1_0 on b1_0.id=bi1_0.bundle_id where b1_0.id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: insert into order_line (bundle_id,is_exclusion,order_id,product_id,quantity,unit_price,id) values (?,?,?,?,?,?,default)
Hibernate: insert into order_line (bundle_id,is_exclusion,order_id,product_id,quantity,unit_price,id) values (?,?,?,?,?,?,default)
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: update customer_order set customer_id=?,discount=?,user_id=?,reconciled=?,status=?,store_id=?,total_amount=? where id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into bundle (active,description,name,price,sku,id) values (?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,bi1_0.quantity from bundle_item bi1_0 join bundle b1_0 on b1_0.id=bi1_0.bundle_id join product p1_0 on p1_0.id=bi1_0.product_id where (bi1_0.bundle_id,bi1_0.product_id) in ((?,?))
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,bi1_0.quantity from bundle_item bi1_0 join bundle b1_0 on b1_0.id=bi1_0.bundle_id join product p1_0 on p1_0.id=bi1_0.product_id where (bi1_0.bundle_id,bi1_0.product_id) in ((?,?))
Hibernate: insert into bundle_item (quantity,bundle_id,product_id) values (?,?,?)
Hibernate: insert into bundle_item (quantity,bundle_id,product_id) values (?,?,?)
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
2026-01-15T16:10:05.233+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:05.234+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: employee, Role: EMPLOYEE, Authority: ROLE_EMPLOYEE
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into customer_order (created_at,customer_id,discount,user_id,reconciled,status,store_id,total_amount,id) values (?,?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
[ERROR] Tests run: 3, Failures: 0, Errors: 2, Skipped: 0, Time elapsed: 1.117 s <<< FAILURE! -- in com.storefront.OrderIntegrationTest
[ERROR] com.storefront.OrderIntegrationTest.testOrder_InvalidStore -- Time elapsed: 0.149 s <<< ERROR!
jakarta.servlet.ServletException: Request processing failed: java.lang.IllegalArgumentException: Store not found
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1022)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at org.springframework.test.web.servlet.TestDispatcherServlet.service(TestDispatcherServlet.java:72)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.springframework.mock.web.MockFilterChain$ServletFilterProxy.doFilter(MockFilterChain.java:165)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at com.storefront.security.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:89)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:225)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.test.web.servlet.MockMvc.perform(MockMvc.java:201)
	at com.storefront.OrderIntegrationTest.testOrder_InvalidStore(OrderIntegrationTest.java:205)
	at java.base/java.lang.reflect.Method.invoke(Method.java:565)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)
Caused by: java.lang.IllegalArgumentException: Store not found
	at com.storefront.service.OrderService.lambda$createOrder$0(OrderService.java:46)
	at java.base/java.util.Optional.orElseThrow(Optional.java:403)
	at com.storefront.service.OrderService.createOrder(OrderService.java:46)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
	at java.base/java.lang.reflect.Method.invoke(Method.java:565)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.storefront.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.storefront.controller.OrderController.createOrder(OrderController.java:31)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
	at java.base/java.lang.reflect.Method.invoke(Method.java:565)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:262)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:190)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	... 77 more

[ERROR] com.storefront.OrderIntegrationTest.testOrder_InsufficientStock -- Time elapsed: 0.112 s <<< ERROR!
jakarta.servlet.ServletException: Request processing failed: java.lang.IllegalArgumentException: Insufficient stock for SKU-B1. Available: 20
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1022)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885)
	at org.springframework.test.web.servlet.TestDispatcherServlet.service(TestDispatcherServlet.java:72)
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658)
	at org.springframework.mock.web.MockFilterChain$ServletFilterProxy.doFilter(MockFilterChain.java:165)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:110)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:108)
	at org.springframework.security.web.FilterChainProxy.lambda$doFilterInternal$3(FilterChainProxy.java:231)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:365)
	at org.springframework.security.web.access.intercept.AuthorizationFilter.doFilter(AuthorizationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:126)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at com.storefront.security.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:89)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.servlet.handler.HandlerMappingIntrospector.lambda$createCacheFilter$3(HandlerMappingIntrospector.java:195)
	at org.springframework.web.filter.CompositeFilter$VirtualFilterChain.doFilter(CompositeFilter.java:113)
	at org.springframework.web.filter.CompositeFilter.doFilter(CompositeFilter.java:74)
	at org.springframework.security.config.annotation.web.configuration.WebMvcSecurityConfiguration$CompositeFilterChainProxy.doFilter(WebMvcSecurityConfiguration.java:225)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.test.web.servlet.setup.MockMvcFilterDecorator.doFilter(MockMvcFilterDecorator.java:151)
	at org.springframework.mock.web.MockFilterChain.doFilter(MockFilterChain.java:132)
	at org.springframework.test.web.servlet.MockMvc.perform(MockMvc.java:201)
	at com.storefront.OrderIntegrationTest.testOrder_InsufficientStock(OrderIntegrationTest.java:189)
	at java.base/java.lang.reflect.Method.invoke(Method.java:565)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)
Caused by: java.lang.IllegalArgumentException: Insufficient stock for SKU-B1. Available: 20
	at com.storefront.service.OrderService.decrementStock(OrderService.java:138)
	at com.storefront.service.OrderService.createOrder(OrderService.java:67)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
	at java.base/java.lang.reflect.Method.invoke(Method.java:565)
	at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:352)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:196)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.transaction.interceptor.TransactionInterceptor$1.proceedWithInvocation(TransactionInterceptor.java:123)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:385)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:119)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:184)
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:765)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:717)
	at com.storefront.service.OrderService$$SpringCGLIB$$0.createOrder(<generated>)
	at com.storefront.controller.OrderController.createOrder(OrderController.java:31)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)
	at java.base/java.lang.reflect.Method.invoke(Method.java:565)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:262)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:190)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:917)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:829)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014)
	... 77 more

[INFO] Running com.storefront.ProductAttributesTest
2026-01-15T16:10:05.243+05:30  INFO 31176 --- [storefront-server] [           main] t.c.s.AnnotationConfigContextLoaderUtils : Could not detect default configuration classes for test class [com.storefront.ProductAttributesTest]: ProductAttributesTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2026-01-15T16:10:05.244+05:30  INFO 31176 --- [storefront-server] [           main] .b.t.c.SpringBootTestContextBootstrapper : Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.ProductAttributesTest
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
[INFO] Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.023 s -- in com.storefront.ProductAttributesTest
[INFO] Running com.storefront.SecurityIntegrationTest
2026-01-15T16:10:05.267+05:30  INFO 31176 --- [storefront-server] [           main] t.c.s.AnnotationConfigContextLoaderUtils : Could not detect default configuration classes for test class [com.storefront.SecurityIntegrationTest]: SecurityIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2026-01-15T16:10:05.268+05:30  INFO 31176 --- [storefront-server] [           main] .b.t.c.SpringBootTestContextBootstrapper : Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.SecurityIntegrationTest

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.1)

2026-01-15T16:10:05.280+05:30  INFO 31176 --- [storefront-server] [           main] com.storefront.SecurityIntegrationTest   : Starting SecurityIntegrationTest using Java 25.0.1 with PID 31176 (started by Ahzam Ali in D:\e-workspace\StoreFront-v2\server)
2026-01-15T16:10:05.281+05:30  INFO 31176 --- [storefront-server] [           main] com.storefront.SecurityIntegrationTest   : No active profile set, falling back to 1 default profile: "default"
2026-01-15T16:10:05.385+05:30  INFO 31176 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-15T16:10:05.398+05:30  INFO 31176 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 12 ms. Found 11 JPA repository interfaces.
2026-01-15T16:10:05.441+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-7 - Starting...
2026-01-15T16:10:05.443+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-7 - Added connection conn60: url=jdbc:h2:mem:testdb_sec user=SA
2026-01-15T16:10:05.443+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-7 - Start completed.
2026-01-15T16:10:05.447+05:30  INFO 31176 --- [storefront-server] [           main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:testdb_sec (H2 2.2)
2026-01-15T16:10:05.447+05:30  WARN 31176 --- [storefront-server] [           main] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-15T16:10:05.450+05:30  INFO 31176 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-15T16:10:05.451+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbValidate     : Successfully validated 3 migrations (execution time 00:00.002s)
2026-01-15T16:10:05.452+05:30  INFO 31176 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-15T16:10:05.455+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-15T16:10:05.457+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - init schema"
2026-01-15T16:10:05.464+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "4 - add reconciliation log"
2026-01-15T16:10:05.466+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - add product is active"
2026-01-15T16:10:05.468+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Successfully applied 3 migrations to schema "PUBLIC", now at version v5 (execution time 00:00.005s)
2026-01-15T16:10:05.478+05:30  INFO 31176 --- [storefront-server] [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-15T16:10:05.480+05:30  INFO 31176 --- [storefront-server] [           main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-15T16:10:05.482+05:30  INFO 31176 --- [storefront-server] [           main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-15T16:10:05.483+05:30  WARN 31176 --- [storefront-server] [           main] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-15T16:10:05.572+05:30  INFO 31176 --- [storefront-server] [           main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
Hibernate: alter table if exists bundle alter column price set data type numeric(38,2)
Hibernate: create table customer (id bigint generated by default as identity, created_at timestamp(6), name varchar(255) not null, phone varchar(255) not null, primary key (id))
Hibernate: alter table if exists customer_order alter column total_amount set data type numeric(38,2)
Hibernate: alter table if exists customer_order add column customer_id bigint
Hibernate: alter table if exists order_line alter column unit_price set data type numeric(38,2)
Hibernate: alter table if exists product alter column base_price set data type numeric(38,2)
Hibernate: alter table if exists reconciliation_log alter column total_revenue set data type numeric(38,2)
Hibernate: alter table if exists customer drop constraint if exists UK_o3uty20c6csmx5y4uk2tc5r4m
Hibernate: alter table if exists customer add constraint UK_o3uty20c6csmx5y4uk2tc5r4m unique (phone)
Hibernate: alter table if exists customer_order add constraint FKf9abd30bhiqvugayxlpq8ryq9 foreign key (customer_id) references customer
2026-01-15T16:10:05.583+05:30  INFO 31176 --- [storefront-server] [           main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-15T16:10:05.586+05:30  WARN 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : JWT signing key initialized (NEW KEY GENERATED - all previous tokens are now invalid)
2026-01-15T16:10:05.733+05:30  WARN 31176 --- [storefront-server] [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-15T16:10:05.740+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.a.w.s.WelcomePageHandlerMapping    : Adding welcome page: class path resource [static/index.html]
2026-01-15T16:10:05.764+05:30  INFO 31176 --- [storefront-server] [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@6776e974, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@3c9e4c38, org.springframework.security.web.context.SecurityContextHolderFilter@791e4ccc, org.springframework.security.web.header.HeaderWriterFilter@9fbac3f, org.springframework.web.filter.CorsFilter@2ed8882e, org.springframework.security.web.authentication.logout.LogoutFilter@5442accb, com.storefront.security.JwtAuthenticationFilter@6254a37b, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@31b1950e, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@65ff5d53, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@11181799, org.springframework.security.web.session.SessionManagementFilter@587ee77, org.springframework.security.web.access.ExceptionTranslationFilter@256da140, org.springframework.security.web.access.intercept.AuthorizationFilter@26933d99]
2026-01-15T16:10:05.805+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:testdb_sec'
2026-01-15T16:10:05.814+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.t.m.w.SpringBootMockServletContext : Initializing Spring TestDispatcherServlet ''
2026-01-15T16:10:05.814+05:30  INFO 31176 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Initializing Servlet ''
2026-01-15T16:10:05.814+05:30  INFO 31176 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Completed initialization in 0 ms
2026-01-15T16:10:05.817+05:30  INFO 31176 --- [storefront-server] [           main] com.storefront.SecurityIntegrationTest   : Started SecurityIntegrationTest in 0.547 seconds (process running for 14.66)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: admin_sec
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: emp_sec
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
2026-01-15T16:10:06.039+05:30 ERROR 31176 --- [storefront-server] [           main] com.storefront.config.SecurityConfig     : Authentication failed for GET /api/v1/auth/users: Full authentication is required to access this resource
=== LOGIN DEBUG ===
Attempting login for username: admin_sec
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: emp_sec
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
2026-01-15T16:10:06.178+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:06.179+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: emp_sec, Role: EMPLOYEE, Authority: ROLE_EMPLOYEE
2026-01-15T16:10:06.180+05:30 ERROR 31176 --- [storefront-server] [           main] com.storefront.config.SecurityConfig     : Access DENIED for GET /api/v1/auth/users - User: UsernamePasswordAuthenticationToken [Principal=org.springframework.security.core.userdetails.User [Username=emp_sec, Password=[PROTECTED], Enabled=true, AccountNonExpired=true, CredentialsNonExpired=true, AccountNonLocked=true, Granted Authorities=[ROLE_EMPLOYEE]], Credentials=[PROTECTED], Authenticated=true, Details=WebAuthenticationDetails [RemoteIpAddress=127.0.0.1, SessionId=null], Granted Authorities=[ROLE_EMPLOYEE]], Error: Access Denied
=== LOGIN DEBUG ===
Attempting login for username: admin_sec
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: emp_sec
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
2026-01-15T16:10:06.317+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:06.320+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_sec, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: admin_sec
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: emp_sec
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
2026-01-15T16:10:06.525+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:06.528+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_sec, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
=== LOGIN DEBUG ===
Attempting login for username: admin_sec
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: emp_sec
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: ' OR '1'='1
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
[INFO] Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.408 s -- in com.storefront.SecurityIntegrationTest
[INFO] Running com.storefront.StoreIntegrationTest
2026-01-15T16:10:06.675+05:30  INFO 31176 --- [storefront-server] [           main] t.c.s.AnnotationConfigContextLoaderUtils : Could not detect default configuration classes for test class [com.storefront.StoreIntegrationTest]: StoreIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2026-01-15T16:10:06.677+05:30  INFO 31176 --- [storefront-server] [           main] .b.t.c.SpringBootTestContextBootstrapper : Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.StoreIntegrationTest

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.1)

2026-01-15T16:10:06.689+05:30  INFO 31176 --- [storefront-server] [           main] com.storefront.StoreIntegrationTest      : Starting StoreIntegrationTest using Java 25.0.1 with PID 31176 (started by Ahzam Ali in D:\e-workspace\StoreFront-v2\server)
2026-01-15T16:10:06.689+05:30  INFO 31176 --- [storefront-server] [           main] com.storefront.StoreIntegrationTest      : No active profile set, falling back to 1 default profile: "default"
2026-01-15T16:10:06.783+05:30  INFO 31176 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-15T16:10:06.795+05:30  INFO 31176 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 12 ms. Found 11 JPA repository interfaces.
2026-01-15T16:10:06.843+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-8 - Starting...
2026-01-15T16:10:06.843+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-8 - Added connection conn70: url=jdbc:h2:mem:testdb_store user=SA
2026-01-15T16:10:06.844+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-8 - Start completed.
2026-01-15T16:10:06.847+05:30  INFO 31176 --- [storefront-server] [           main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:testdb_store (H2 2.2)
2026-01-15T16:10:06.848+05:30  WARN 31176 --- [storefront-server] [           main] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-15T16:10:06.850+05:30  INFO 31176 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-15T16:10:06.850+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbValidate     : Successfully validated 3 migrations (execution time 00:00.001s)
2026-01-15T16:10:06.851+05:30  INFO 31176 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-15T16:10:06.854+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-15T16:10:06.856+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - init schema"
2026-01-15T16:10:06.863+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "4 - add reconciliation log"
2026-01-15T16:10:06.865+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - add product is active"
2026-01-15T16:10:06.868+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Successfully applied 3 migrations to schema "PUBLIC", now at version v5 (execution time 00:00.005s)
2026-01-15T16:10:06.878+05:30  INFO 31176 --- [storefront-server] [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-15T16:10:06.881+05:30  INFO 31176 --- [storefront-server] [           main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-15T16:10:06.883+05:30  INFO 31176 --- [storefront-server] [           main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-15T16:10:06.884+05:30  WARN 31176 --- [storefront-server] [           main] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-15T16:10:06.968+05:30  INFO 31176 --- [storefront-server] [           main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
Hibernate: alter table if exists bundle alter column price set data type numeric(38,2)
Hibernate: create table customer (id bigint generated by default as identity, created_at timestamp(6), name varchar(255) not null, phone varchar(255) not null, primary key (id))
Hibernate: alter table if exists customer_order alter column total_amount set data type numeric(38,2)
Hibernate: alter table if exists customer_order add column customer_id bigint
Hibernate: alter table if exists order_line alter column unit_price set data type numeric(38,2)
Hibernate: alter table if exists product alter column base_price set data type numeric(38,2)
Hibernate: alter table if exists reconciliation_log alter column total_revenue set data type numeric(38,2)
Hibernate: alter table if exists customer drop constraint if exists UK_o3uty20c6csmx5y4uk2tc5r4m
Hibernate: alter table if exists customer add constraint UK_o3uty20c6csmx5y4uk2tc5r4m unique (phone)
Hibernate: alter table if exists customer_order add constraint FKf9abd30bhiqvugayxlpq8ryq9 foreign key (customer_id) references customer
2026-01-15T16:10:06.978+05:30  INFO 31176 --- [storefront-server] [           main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-15T16:10:06.981+05:30  WARN 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : JWT signing key initialized (NEW KEY GENERATED - all previous tokens are now invalid)
2026-01-15T16:10:07.125+05:30  WARN 31176 --- [storefront-server] [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-15T16:10:07.134+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.a.w.s.WelcomePageHandlerMapping    : Adding welcome page: class path resource [static/index.html]
2026-01-15T16:10:07.157+05:30  INFO 31176 --- [storefront-server] [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@36f8ea6, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@7c3ccb39, org.springframework.security.web.context.SecurityContextHolderFilter@2e874fe2, org.springframework.security.web.header.HeaderWriterFilter@3a3fb848, org.springframework.web.filter.CorsFilter@7f8ac06f, org.springframework.security.web.authentication.logout.LogoutFilter@65a44d8a, com.storefront.security.JwtAuthenticationFilter@40c253bd, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@1ae42bfe, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@5dde2d12, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@39310988, org.springframework.security.web.session.SessionManagementFilter@4c3c10cf, org.springframework.security.web.access.ExceptionTranslationFilter@1364f66a, org.springframework.security.web.access.intercept.AuthorizationFilter@446043bd]
2026-01-15T16:10:07.198+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:testdb_store'
2026-01-15T16:10:07.205+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.t.m.w.SpringBootMockServletContext : Initializing Spring TestDispatcherServlet ''
2026-01-15T16:10:07.205+05:30  INFO 31176 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Initializing Servlet ''
2026-01-15T16:10:07.205+05:30  INFO 31176 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Completed initialization in 0 ms
2026-01-15T16:10:07.208+05:30  INFO 31176 --- [storefront-server] [           main] com.storefront.StoreIntegrationTest      : Started StoreIntegrationTest in 0.53 seconds (process running for 16.051)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
2026-01-15T16:10:07.429+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:07.431+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: user_a, Role: STORE_ADMIN, Authority: ROLE_STORE_ADMIN

MockHttpServletRequest:
      HTTP Method = POST
      Request URI = /api/v1/stores/3/allocate
       Parameters = {}
          Headers = [Content-Type:"application/json;charset=UTF-8", Authorization:"Bearer eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiJ1c2VyX2EiLCJyb2xlIjoiU1RPUkVfQURNSU4iLCJ1c2VySWQiOjMsImlhdCI6MTc2ODQ3MzYwNywiZXhwIjoxNzY4NDc3MjA3fQ.lqUCxHhlDN6sy0LJCh9KOX4gTV6RswXBYME2u88M6pZpM4EqZsFtP9vJI1h4gVbs2fOrukwxSON69WS12eqrAA", Content-Length:"12"]
             Body = {"items":[]}
    Session Attrs = {}

Handler:
             Type = com.storefront.controller.StoreController
           Method = com.storefront.controller.StoreController#allocate(Long, AllocationRequestDTO, UserDetails)

Async:
    Async started = false
     Async result = null

Resolved Exception:
             Type = org.springframework.web.bind.MethodArgumentNotValidException

ModelAndView:
        View name = null
             View = null
            Model = null

FlashMap:
       Attributes = null

MockHttpServletResponse:
           Status = 400
    Error message = null
          Headers = [Vary:"Origin", "Access-Control-Request-Method", "Access-Control-Request-Headers", Content-Type:"application/json", X-Content-Type-Options:"nosniff", X-XSS-Protection:"0", Cache-Control:"no-cache, no-store, max-age=0, must-revalidate", Pragma:"no-cache", Expires:"0"]
     Content type = application/json
             Body = {"items":"Items list cannot be empty"}
    Forwarded URL = null
   Redirected URL = null
          Cookies = []
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: insert into product (attributes,base_price,created_at,is_active,name,sku,type,id) values (?,?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
2026-01-15T16:10:07.527+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:07.528+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_store, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
2026-01-15T16:10:07.537+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:07.539+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_store, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.is_active
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.is_active
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: insert into bundle (active,description,name,price,sku,id) values (?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,bi1_0.quantity from bundle_item bi1_0 join bundle b1_0 on b1_0.id=bi1_0.bundle_id join product p1_0 on p1_0.id=bi1_0.product_id where (bi1_0.bundle_id,bi1_0.product_id) in ((?,?))
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,bi1_0.quantity from bundle_item bi1_0 join bundle b1_0 on b1_0.id=bi1_0.bundle_id join product p1_0 on p1_0.id=bi1_0.product_id where (bi1_0.bundle_id,bi1_0.product_id) in ((?,?))
2026-01-15T16:10:07.561+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:07.564+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_store, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.sku=?
Hibernate: select b1_0.id,b1_0.active,b1_0.description,b1_0.name,b1_0.price,b1_0.sku from bundle b1_0 where b1_0.sku=?
Hibernate: insert into bundle_item (quantity,bundle_id,product_id) values (?,?,?)
Hibernate: insert into bundle_item (quantity,bundle_id,product_id) values (?,?,?)
Hibernate: select bi1_0.bundle_id,bi1_0.product_id,bi1_0.quantity from bundle_item bi1_0 left join bundle b1_0 on b1_0.id=bi1_0.bundle_id where b1_0.id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type,sl1_0.quantity,s1_0.id,s1_0.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,s2_0.user_id,s2_1.id,s2_1.created_at,s2_1.name,s2_1.type,co1_0.username,s1_0.name,s1_0.type from stock_level sl1_0 join product p1_0 on p1_0.id=sl1_0.product_id join store s1_0 on s1_0.id=sl1_0.store_id left join app_user co1_0 on co1_0.id=s1_0.current_owner_user_id left join user_stores s2_0 on co1_0.id=s2_0.user_id left join store s2_1 on s2_1.id=s2_0.store_id where (sl1_0.product_id,sl1_0.store_id) in ((?,?))
Hibernate: insert into stock_level (last_updated,quantity,product_id,store_id) values (?,?,?,?)
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.is_active
Hibernate: select p1_0.id,p1_0.attributes,p1_0.base_price,p1_0.created_at,p1_0.is_active,p1_0.name,p1_0.sku,p1_0.type from product p1_0 where p1_0.is_active
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
2026-01-15T16:10:07.589+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
2026-01-15T16:10:07.591+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_store, Role: ADMIN, Authority: ROLE_ADMIN
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: select co1_0.id,co1_0.created_at,co1_0.customer_id,co1_0.discount,co1_0.user_id,co1_0.reconciled,co1_0.status,co1_0.store_id,co1_0.total_amount from customer_order co1_0 join store s1_0 on s1_0.id=co1_0.store_id where s1_0.id=? and not(co1_0.reconciled)
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id where s1_0.id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: insert into inventory_transfer (from_store_id,product_id,quantity,to_store_id,transferred_at,transferred_by_user_id,id) values (?,?,?,?,?,?,default)
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 left join user_stores s1_0 on au1_0.id=s1_0.user_id where s1_0.store_id=?
Hibernate: insert into reconciliation_log (details_json,inventory_returned,reconciled_at,reconciled_by_user_id,store_id,total_items_sold,total_revenue,id) values (?,?,?,?,?,?,?,default)
Hibernate: update stock_level set last_updated=?,quantity=? where product_id=? and store_id=?
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
Hibernate: select sl1_0.product_id,sl1_0.store_id,sl1_0.last_updated,sl1_0.quantity from stock_level sl1_0 left join store s1_0 on s1_0.id=sl1_0.store_id left join product p1_0 on p1_0.id=sl1_0.product_id where s1_0.id=? and p1_0.id=? for update
[ERROR] Tests run: 2, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.956 s <<< FAILURE! -- in com.storefront.StoreIntegrationTest
[ERROR] com.storefront.StoreIntegrationTest.testStoreAccessBoundary -- Time elapsed: 0.163 s <<< FAILURE!
java.lang.AssertionError: Status expected:<403> but was:<400>
	at org.springframework.test.util.AssertionErrors.fail(AssertionErrors.java:59)
	at org.springframework.test.util.AssertionErrors.assertEquals(AssertionErrors.java:122)
	at org.springframework.test.web.servlet.result.StatusResultMatchers.lambda$matcher$9(StatusResultMatchers.java:637)
	at org.springframework.test.web.servlet.MockMvc$1.andExpect(MockMvc.java:214)
	at com.storefront.StoreIntegrationTest.testStoreAccessBoundary(StoreIntegrationTest.java:215)
	at java.base/java.lang.reflect.Method.invoke(Method.java:565)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)
	at java.base/java.util.ArrayList.forEach(ArrayList.java:1604)

[INFO] Running com.storefront.UserStoreAssignmentTest
2026-01-15T16:10:07.633+05:30  INFO 31176 --- [storefront-server] [           main] t.c.s.AnnotationConfigContextLoaderUtils : Could not detect default configuration classes for test class [com.storefront.UserStoreAssignmentTest]: UserStoreAssignmentTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2026-01-15T16:10:07.634+05:30  INFO 31176 --- [storefront-server] [           main] .b.t.c.SpringBootTestContextBootstrapper : Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.UserStoreAssignmentTest
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
[INFO] Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.029 s -- in com.storefront.UserStoreAssignmentTest
[INFO] Running com.storefront.ValidationIntegrationTest
2026-01-15T16:10:07.664+05:30  INFO 31176 --- [storefront-server] [           main] t.c.s.AnnotationConfigContextLoaderUtils : Could not detect default configuration classes for test class [com.storefront.ValidationIntegrationTest]: ValidationIntegrationTest does not declare any static, non-private, non-final, nested classes annotated with @Configuration.
2026-01-15T16:10:07.665+05:30  INFO 31176 --- [storefront-server] [           main] .b.t.c.SpringBootTestContextBootstrapper : Found @SpringBootConfiguration com.storefront.StoreFrontApplication for test class com.storefront.ValidationIntegrationTest

  .   ____          _            __ _ _
 /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::                (v3.2.1)

2026-01-15T16:10:07.677+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.ValidationIntegrationTest   : Starting ValidationIntegrationTest using Java 25.0.1 with PID 31176 (started by Ahzam Ali in D:\e-workspace\StoreFront-v2\server)
2026-01-15T16:10:07.677+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.ValidationIntegrationTest   : No active profile set, falling back to 1 default profile: "default"
2026-01-15T16:10:07.778+05:30  INFO 31176 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data JPA repositories in DEFAULT mode.
2026-01-15T16:10:07.793+05:30  INFO 31176 --- [storefront-server] [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 13 ms. Found 11 JPA repository interfaces.
2026-01-15T16:10:07.844+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-9 - Starting...
2026-01-15T16:10:07.846+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.pool.HikariPool        : HikariPool-9 - Added connection conn80: url=jdbc:h2:mem:testdb_val user=SA
2026-01-15T16:10:07.846+05:30  INFO 31176 --- [storefront-server] [           main] com.zaxxer.hikari.HikariDataSource       : HikariPool-9 - Start completed.
2026-01-15T16:10:07.852+05:30  INFO 31176 --- [storefront-server] [           main] org.flywaydb.core.FlywayExecutor         : Database: jdbc:h2:mem:testdb_val (H2 2.2)
2026-01-15T16:10:07.852+05:30  WARN 31176 --- [storefront-server] [           main] o.f.c.internal.database.base.Database    : Flyway upgrade recommended: H2 2.2.224 is newer than this version of Flyway and support has not been tested. The latest supported version of H2 is 2.2.220.
2026-01-15T16:10:07.855+05:30  INFO 31176 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Schema history table "PUBLIC"."flyway_schema_history" does not exist yet
2026-01-15T16:10:07.856+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbValidate     : Successfully validated 3 migrations (execution time 00:00.002s)
2026-01-15T16:10:07.856+05:30  INFO 31176 --- [storefront-server] [           main] o.f.c.i.s.JdbcTableSchemaHistory         : Creating Schema History table "PUBLIC"."flyway_schema_history" ...
2026-01-15T16:10:07.859+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Current version of schema "PUBLIC": << Empty Schema >>
2026-01-15T16:10:07.862+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "1 - init schema"
2026-01-15T16:10:07.868+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "4 - add reconciliation log"
2026-01-15T16:10:07.873+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Migrating schema "PUBLIC" to version "5 - add product is active"
2026-01-15T16:10:07.877+05:30  INFO 31176 --- [storefront-server] [           main] o.f.core.internal.command.DbMigrate      : Successfully applied 3 migrations to schema "PUBLIC", now at version v5 (execution time 00:00.007s)
2026-01-15T16:10:07.889+05:30  INFO 31176 --- [storefront-server] [           main] o.hibernate.jpa.internal.util.LogHelper  : HHH000204: Processing PersistenceUnitInfo [name: default]
2026-01-15T16:10:07.892+05:30  INFO 31176 --- [storefront-server] [           main] o.h.c.internal.RegionFactoryInitiator    : HHH000026: Second-level cache disabled
2026-01-15T16:10:07.894+05:30  INFO 31176 --- [storefront-server] [           main] o.s.o.j.p.SpringPersistenceUnitInfo      : No LoadTimeWeaver setup: ignoring JPA class transformer
2026-01-15T16:10:07.895+05:30  WARN 31176 --- [storefront-server] [           main] org.hibernate.orm.deprecation            : HHH90000025: H2Dialect does not need to be specified explicitly using 'hibernate.dialect' (remove the property setting and it will be selected by default)
2026-01-15T16:10:08.007+05:30  INFO 31176 --- [storefront-server] [           main] o.h.e.t.j.p.i.JtaPlatformInitiator       : HHH000489: No JTA platform available (set 'hibernate.transaction.jta.platform' to enable JTA platform integration)
Hibernate: alter table if exists bundle alter column price set data type numeric(38,2)
Hibernate: create table customer (id bigint generated by default as identity, created_at timestamp(6), name varchar(255) not null, phone varchar(255) not null, primary key (id))
Hibernate: alter table if exists customer_order alter column total_amount set data type numeric(38,2)
Hibernate: alter table if exists customer_order add column customer_id bigint
Hibernate: alter table if exists order_line alter column unit_price set data type numeric(38,2)
Hibernate: alter table if exists product alter column base_price set data type numeric(38,2)
Hibernate: alter table if exists reconciliation_log alter column total_revenue set data type numeric(38,2)
Hibernate: alter table if exists customer drop constraint if exists UK_o3uty20c6csmx5y4uk2tc5r4m
Hibernate: alter table if exists customer add constraint UK_o3uty20c6csmx5y4uk2tc5r4m unique (phone)
Hibernate: alter table if exists customer_order add constraint FKf9abd30bhiqvugayxlpq8ryq9 foreign key (customer_id) references customer
2026-01-15T16:10:08.020+05:30  INFO 31176 --- [storefront-server] [           main] j.LocalContainerEntityManagerFactoryBean : Initialized JPA EntityManagerFactory for persistence unit 'default'
2026-01-15T16:10:08.023+05:30  WARN 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : JWT signing key initialized (NEW KEY GENERATED - all previous tokens are now invalid)
2026-01-15T16:10:08.180+05:30  WARN 31176 --- [storefront-server] [           main] JpaBaseConfiguration$JpaWebConfiguration : spring.jpa.open-in-view is enabled by default. Therefore, database queries may be performed during view rendering. Explicitly configure spring.jpa.open-in-view to disable this warning
2026-01-15T16:10:08.188+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.a.w.s.WelcomePageHandlerMapping    : Adding welcome page: class path resource [static/index.html]
2026-01-15T16:10:08.209+05:30  INFO 31176 --- [storefront-server] [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@4292a5c6, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@6ca9dba0, org.springframework.security.web.context.SecurityContextHolderFilter@2b2fdee3, org.springframework.security.web.header.HeaderWriterFilter@3af3d4b9, org.springframework.web.filter.CorsFilter@6a6e3ecd, org.springframework.security.web.authentication.logout.LogoutFilter@49d75bb0, com.storefront.security.JwtAuthenticationFilter@6ad0e35b, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@92690e5, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@2d54db64, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@7baee2, org.springframework.security.web.session.SessionManagementFilter@31c00fe7, org.springframework.security.web.access.ExceptionTranslationFilter@79eb7803, org.springframework.security.web.access.intercept.AuthorizationFilter@31eb7290]
2026-01-15T16:10:08.247+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.a.h2.H2ConsoleAutoConfiguration    : H2 console available at '/h2-console'. Database available at 'jdbc:h2:mem:testdb_val'
2026-01-15T16:10:08.256+05:30  INFO 31176 --- [storefront-server] [           main] o.s.b.t.m.w.SpringBootMockServletContext : Initializing Spring TestDispatcherServlet ''
2026-01-15T16:10:08.256+05:30  INFO 31176 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Initializing Servlet ''
2026-01-15T16:10:08.256+05:30  INFO 31176 --- [storefront-server] [           main] o.s.t.web.servlet.TestDispatcherServlet  : Completed initialization in 0 ms
2026-01-15T16:10:08.260+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.ValidationIntegrationTest   : Started ValidationIntegrationTest in 0.593 seconds (process running for 17.103)
Hibernate: select s1_0.id,s1_0.created_at,s1_0.current_owner_user_id,s1_0.name,s1_0.type from store s1_0 where s1_0.type=? fetch first ? rows only
Hibernate: insert into store (created_at,current_owner_user_id,name,type,id) values (?,?,?,?,default)
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
=== LOGIN DEBUG ===
Attempting login for username: admin_val
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
User NOT found in database!
Hibernate: insert into app_user (created_at,password_hash,role,username,id) values (?,?,?,?,default)
2026-01-15T16:10:08.404+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:10:08.406+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_val, Role: ADMIN, Authority: ROLE_ADMIN
=== LOGIN DEBUG ===
Attempting login for username: admin_val
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
User found! Stored hash: $2a$10$FBFpPic3g42DRvvsDjlJf.VgmBrDcr7xXi7Jy7lV.G5xB/rErCKka
Input password: pass
Password matches: true
===================
=== LOGIN DEBUG ===
Attempting login for username: admin_val
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
User found! Stored hash: $2a$10$FBFpPic3g42DRvvsDjlJf.VgmBrDcr7xXi7Jy7lV.G5xB/rErCKka
Input password: pass
Password matches: true
===================
2026-01-15T16:10:08.561+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:10:08.564+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_val, Role: ADMIN, Authority: ROLE_ADMIN
=== LOGIN DEBUG ===
Attempting login for username: admin_val
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
User found! Stored hash: $2a$10$FBFpPic3g42DRvvsDjlJf.VgmBrDcr7xXi7Jy7lV.G5xB/rErCKka
Input password: pass
Password matches: true
===================
=== LOGIN DEBUG ===
Attempting login for username: admin_val
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
User found! Stored hash: $2a$10$FBFpPic3g42DRvvsDjlJf.VgmBrDcr7xXi7Jy7lV.G5xB/rErCKka
Input password: pass
Password matches: true
===================
2026-01-15T16:10:08.714+05:30  INFO 31176 --- [storefront-server] [           main] c.storefront.security.JwtTokenProvider   : ? JWT token validation SUCCESSFUL
Hibernate: select au1_0.id,au1_0.created_at,au1_0.password_hash,au1_0.role,au1_0.username from app_user au1_0 where au1_0.username=?
Hibernate: select s1_0.user_id,s1_1.id,s1_1.created_at,co1_0.id,co1_0.created_at,co1_0.password_hash,co1_0.role,co1_0.username,s1_1.name,s1_1.type from user_stores s1_0 join store s1_1 on s1_1.id=s1_0.store_id left join app_user co1_0 on co1_0.id=s1_1.current_owner_user_id where s1_0.user_id=?
2026-01-15T16:10:08.716+05:30  INFO 31176 --- [storefront-server] [           main] c.s.security.CustomUserDetailsService    : User found: admin_val, Role: ADMIN, Authority: ROLE_ADMIN
[INFO] Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.057 s -- in com.storefront.ValidationIntegrationTest
[INFO] 
[INFO] Results:
[INFO] 
[ERROR] Failures: 
[ERROR]   StoreIntegrationTest.testStoreAccessBoundary:215 Status expected:<403> but was:<400>
[ERROR] Errors: 
[ERROR]   ConcurrencyIntegrationTest.testConcurrentAllocation:120 ╗ InvalidDataAccessApiUsage Query requires transaction be in progress, but no transaction is known to be in progress
[ERROR]   OrderIntegrationTest.testOrder_InsufficientStock:189 ╗ Servlet Request processing failed: java.lang.IllegalArgumentException: Insufficient stock for SKU-B1. Available: 20
[ERROR]   OrderIntegrationTest.testOrder_InvalidStore:205 ╗ Servlet Request processing failed: java.lang.IllegalArgumentException: Store not found
[INFO] 
[ERROR] Tests run: 30, Failures: 1, Errors: 3, Skipped: 0
[INFO] 
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  19.659 s
[INFO] Finished at: 2026-01-15T16:10:08+05:30
[INFO] ------------------------------------------------------------------------
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:3.1.2:test (default-test) on project storefront-server: There are test failures.
[ERROR] 
[ERROR] Please refer to D:\e-workspace\StoreFront-v2\server\target\surefire-reports for the individual test results.
[ERROR] Please refer to dump files (if any exist) [date].dump, [date]-jvmRun[N].dump and [date].dumpstream.
[ERROR] -> [Help 1]
[ERROR] 
[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.
[ERROR] Re-run Maven using the -X switch to enable full debug logging.
[ERROR] 
[ERROR] For more information about the errors and possible solutions, please read the following articles:
[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException
